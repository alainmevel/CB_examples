/*2023-10-03T11:13:50-01:00*/

/********************************************************************
 * pb_door.c
 * 
 * generated by: plcgen 3.1.391
 ********************************************************************/

#include "cb_comp.h"
#include "iec_1131.h"

#include "pb_door.h"


/**************************** Variables *****************************/

CB_Index pb_door__num = 0;
CB_Mem_Bool *pb_door_doorPB;
CB_Mem_Bool *pb_door_button;
CB_Mem_Bool *pb_door__X_10;
CB_Mem_Bool *pb_door__X_11;
CB_Mem_Bool *pb_door__X_12;
CB_Mem_Int *pb_door__TIMER_11;
CB_Mem_Bool *pb_door__X_11_PREV;

/**************************** Variables *****************************/

#define doorPB (pb_door_doorPB->CB_current_value)
#define button (pb_door_button->CB_current_value)
#define _X_10 (pb_door__X_10->CB_current_value)
#define _X_11 (pb_door__X_11->CB_current_value)
#define _X_12 (pb_door__X_12->CB_current_value)
#define _TIMER_11 (*((unsigned long *)&(pb_door__TIMER_11->CB_current_value)))
#define _X_11_PREV (pb_door__X_11_PREV->CB_current_value)


/************************ Components offsets ************************/


/********************* Initialization function **********************/

int _tni_train__pb_door_init(void)
{
	(self.Bool+1)->CB_current_value = 1; /*_X_10*/
	self.Bool+=5;
	self.Int+=1;


	return 0;
}


/************************ Behavior function *************************/

int tni_train__pb_door(void)
{
	if (exec_term_node(self_num)) {

		/*********************** Internals variables ************************/

		pb_door_button = self.Bool+0;
		pb_door__X_10 = self.Bool+1;
		pb_door__X_11 = self.Bool+2;
		pb_door__X_12 = self.Bool+3;
		pb_door__TIMER_11 = self.Int+0;
		pb_door__X_11_PREV = self.Bool+4;

		/********************* Pre-conditions execution *********************/

		/*no Pre-conditions*/

		/************************ Behavior execution ************************/

		{
			unsigned char _Y_6;
			unsigned char _Y_5;
			unsigned char _Y_4;
			/*pre-SFC*/
			/*transitions G1*/
			_Y_6 = _X_10 && button;
			_Y_5 = _X_11 && (_TIMER_11 >= 1 * 1000000.0 / CLOCK_PERIOD);
			_Y_4 = _X_12;
			/*evolutions G1*/
			if (_Y_6) {
				_X_10 = 0;
			}
			if (_Y_5) {
				_X_11 = 0;
			}
			if (_Y_4) {
				_X_12 = 0;
			}
			if (_Y_6) {
				_X_11 = 1;
			}
			if (_Y_5) {
				_X_12 = 1;
			}
			if (_Y_4) {
				_X_10 = 1;
			}
			/*timers G1*/
			if (_X_11) {
				if (CB_edge_bool(_X_11, _X_11_PREV) > 0) {
					_TIMER_11 = 0;
				}
				else {
					if (_TIMER_11 < _MAX_TIMER) {
						_TIMER_11 = _TIMER_11 + 1;
					}
				}
			}
			/*actions G1*/
			if (CB_edge_bool(_X_11, _X_11_PREV) < 0) {
				doorPB = 0;
			}
			if (_X_11) {
				doorPB = 1;
				button = 0;
			}
			/*post-SFC*/
			_X_11_PREV = _X_11;
		}

		CB_post_bool(pb_door_doorPB);

		/******************** Post-conditions execution *********************/

		/*no Post-conditions*/
	}

	/*************************** self update ****************************/

	self.Bool += 5;
	self.Int += 1;

	return 0;
}

