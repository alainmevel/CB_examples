/*2023-10-03T11:13:52-01:00*/

/********************************************************************
 * door.c
 * 
 * generated by: plcgen 3.1.391
 ********************************************************************/

#include "cb_comp.h"
#include "iec_1131.h"

#include "door.h"
#include "tni_train/functional/pb_door/pb_door.h"
#include "tni_train/functional/op_door_locking/op_door_locking.h"
#include "tni_train/functional/cp_door/cp_door.h"
#include "tni_train/functional/op_door/op_door.h"


/**************************** Variables *****************************/

CB_Index door__num = 0;
CB_Mem_Float *door_compressedAir;
CB_Mem_Bool *door_cmdSupply;
CB_Mem_Bool *door_sensorSupply;
CB_Mem_Bool *door_enableOpening;
CB_Mem_Bool *door_enableClosing;
CB_Mem_Bool *door_closedDoorState;
CB_Mem_Bool *door_openedDoorState;
CB_Mem_Int *door_faultState;

/**************************** Variables *****************************/



/************************ Components offsets ************************/

static CB_Offset tni_train__door_offset_doorPB;
static CB_Offset tni_train__door_offset_doorLocking;
static CB_Offset tni_train__door_offset_doorControlPart;
static CB_Offset tni_train__door_offset_door;
static CB_Offset tni_train__door_offset__end = {0, 0, 0, 0};


/********************* Initialization function **********************/

int _tni_train__door_init(void)
{
	CB_Object __start = self;
	(door_compressedAir)->CB_current_value = 200.0; /*compressedAir*/
	(door_cmdSupply)->CB_current_value = 1; /*cmdSupply*/
	(door_sensorSupply)->CB_current_value = 1; /*sensorSupply*/
	self.Bool+=10;

	/*initialize child doorPB (tni_train.pb_door):*/
	self_num++;
	tni_train__door_offset_doorPB.Bool = self.Bool - __start.Bool;
	tni_train__door_offset_doorPB.Int = self.Int - __start.Int;
	tni_train__door_offset_doorPB.Float = self.Float - __start.Float;
	tni_train__door_offset_doorPB.Char = self.Char - __start.Char;
	pb_door_doorPB = __start.Bool+6; /*door__cn_4*/
	_tni_train__pb_door_init();

	/*initialize child doorLocking (tni_train.op_door_locking):*/
	self_num++;
	tni_train__door_offset_doorLocking.Bool = self.Bool - __start.Bool;
	tni_train__door_offset_doorLocking.Int = self.Int - __start.Int;
	tni_train__door_offset_doorLocking.Float = self.Float - __start.Float;
	tni_train__door_offset_doorLocking.Char = self.Char - __start.Char;
	op_door_locking_lockingCmd = __start.Bool+0; /*door__cn_10*/
	op_door_locking_unlockingCmd = __start.Bool+1; /*door__cn_9*/
	op_door_locking_doorLocked = __start.Bool+4; /*door__cn_6*/
	op_door_locking_doorUnlocked = __start.Bool+5; /*door__cn_5*/
	op_door_locking_lockActive = __start.Bool+9; /*door__cn_1*/
	_tni_train__op_door_locking_init();

	/*initialize child doorControlPart (tni_train.cp_door):*/
	self_num++;
	tni_train__door_offset_doorControlPart.Bool = self.Bool - __start.Bool;
	tni_train__door_offset_doorControlPart.Int = self.Int - __start.Int;
	tni_train__door_offset_doorControlPart.Float = self.Float - __start.Float;
	tni_train__door_offset_doorControlPart.Char = self.Char - __start.Char;
	cp_door_enableOpening = door_enableOpening;
	cp_door_enableClosing = door_enableClosing;
	cp_door_openedDoor = __start.Bool+2; /*door__cn_8*/
	cp_door_closedDoor = __start.Bool+3; /*door__cn_7*/
	cp_door_lockedDoor = __start.Bool+4; /*door__cn_6*/
	cp_door_unlockedDoor = __start.Bool+5; /*door__cn_5*/
	cp_door_openingRequest = __start.Bool+6; /*door__cn_4*/
	cp_door_doorOpeningCmd = __start.Bool+7; /*door__cn_3*/
	cp_door_doorClosingCmd = __start.Bool+8; /*door__cn_2*/
	cp_door_doorLockingCmd = __start.Bool+0; /*door__cn_10*/
	cp_door_doorUnlockingCmd = __start.Bool+1; /*door__cn_9*/
	cp_door_closedDoorState = door_closedDoorState;
	cp_door_openedDoorState = door_openedDoorState;
	cp_door_faultState = door_faultState;
	_tni_train__cp_door_init();

	/*initialize child door (tni_train.op_door):*/
	self_num++;
	tni_train__door_offset_door.Bool = self.Bool - __start.Bool;
	tni_train__door_offset_door.Int = self.Int - __start.Int;
	tni_train__door_offset_door.Float = self.Float - __start.Float;
	tni_train__door_offset_door.Char = self.Char - __start.Char;
	op_door_compressedAir = door_compressedAir;
	op_door_cmdSupply = door_cmdSupply;
	op_door_sensorSupply = door_sensorSupply;
	op_door_openDoorCmd = __start.Bool+7; /*door__cn_3*/
	op_door_closeDoorCmd = __start.Bool+8; /*door__cn_2*/
	op_door_lockActive = __start.Bool+9; /*door__cn_1*/
	op_door_doorOpened = __start.Bool+2; /*door__cn_8*/
	op_door_doorClosed = __start.Bool+3; /*door__cn_7*/
	_tni_train__op_door_init();

	tni_train__door_offset__end.Bool = self.Bool - __start.Bool;
	tni_train__door_offset__end.Int = self.Int - __start.Int;
	tni_train__door_offset__end.Float = self.Float - __start.Float;
	tni_train__door_offset__end.Char = self.Char - __start.Char;

	return 0;
}


/************************ Behavior function *************************/

int tni_train__door(void)
{
	CB_Object __start = self;
	int __ret;
	if (exec_mac_node(self_num)) {

		/*********************** Internals variables ************************/

																				
		/********************* Pre-conditions execution *********************/

		/*no Pre-conditions*/

		/************************ Behavior execution ************************/

		{
			self.Bool = __start.Bool + tni_train__door_offset_doorPB.Bool;
			self.Int = __start.Int + tni_train__door_offset_doorPB.Int;
			self.Float = __start.Float + tni_train__door_offset_doorPB.Float;
			self.Char = __start.Char + tni_train__door_offset_doorPB.Char;

			/************************* doorPB execution *************************/

			self_num++;
			if (pb_door__num != self_num) {
				pb_door__num = self_num;
				pb_door_doorPB = __start.Bool+6; /*door__cn_4*/
			}
			__ret = tni_train__pb_door();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

			/********************** doorLocking execution ***********************/

			self_num++;
			if (op_door_locking__num != self_num) {
				op_door_locking__num = self_num;
				op_door_locking_lockingCmd = __start.Bool+0; /*door__cn_10*/
				op_door_locking_unlockingCmd = __start.Bool+1; /*door__cn_9*/
				op_door_locking_doorLocked = __start.Bool+4; /*door__cn_6*/
				op_door_locking_doorUnlocked = __start.Bool+5; /*door__cn_5*/
				op_door_locking_lockActive = __start.Bool+9; /*door__cn_1*/
			}
			__ret = tni_train__op_door_locking();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

			/******************** doorControlPart execution *********************/

			self_num++;
			if (cp_door__num != self_num) {
				cp_door__num = self_num;
				cp_door_enableOpening = door_enableOpening;
				cp_door_enableClosing = door_enableClosing;
				cp_door_openedDoor = __start.Bool+2; /*door__cn_8*/
				cp_door_closedDoor = __start.Bool+3; /*door__cn_7*/
				cp_door_lockedDoor = __start.Bool+4; /*door__cn_6*/
				cp_door_unlockedDoor = __start.Bool+5; /*door__cn_5*/
				cp_door_openingRequest = __start.Bool+6; /*door__cn_4*/
				cp_door_doorOpeningCmd = __start.Bool+7; /*door__cn_3*/
				cp_door_doorClosingCmd = __start.Bool+8; /*door__cn_2*/
				cp_door_doorLockingCmd = __start.Bool+0; /*door__cn_10*/
				cp_door_doorUnlockingCmd = __start.Bool+1; /*door__cn_9*/
				cp_door_closedDoorState = door_closedDoorState;
				cp_door_openedDoorState = door_openedDoorState;
				cp_door_faultState = door_faultState;
			}
			__ret = tni_train__cp_door();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

			/************************** door execution **************************/

			self_num++;
			if (op_door__num != self_num) {
				op_door__num = self_num;
				op_door_compressedAir = door_compressedAir;
				op_door_cmdSupply = door_cmdSupply;
				op_door_sensorSupply = door_sensorSupply;
				op_door_openDoorCmd = __start.Bool+7; /*door__cn_3*/
				op_door_closeDoorCmd = __start.Bool+8; /*door__cn_2*/
				op_door_lockActive = __start.Bool+9; /*door__cn_1*/
				op_door_doorOpened = __start.Bool+2; /*door__cn_8*/
				op_door_doorClosed = __start.Bool+3; /*door__cn_7*/
			}
			__ret = tni_train__op_door();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

		}


		/******************** Post-conditions execution *********************/

		/*no Post-conditions*/
	}

	/*************************** self update ****************************/

	self.Bool = __start.Bool + tni_train__door_offset__end.Bool;
	self.Int = __start.Int + tni_train__door_offset__end.Int;
	self.Float = __start.Float + tni_train__door_offset__end.Float;
	self.Char = __start.Char + tni_train__door_offset__end.Char;

	return 0;
}

