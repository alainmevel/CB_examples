/*2023-10-03T11:13:51-01:00*/

/********************************************************************
 * cab.c
 * 
 * generated by: plcgen 3.1.391
 ********************************************************************/

#include "cb_comp.h"
#include "iec_1131.h"

#include "cab.h"
#include "tni_train/functional/key2position/key2position.h"
#include "tni_train/functional/service_side/service_side.h"
#include "tni_train/functional/pb/pb.h"
#include "tni_train/functional/speed/speed.h"
#include "tni_train/functional/cp_cab/cp_cab.h"


/**************************** Variables *****************************/

CB_Index cab__num = 0;
CB_Mem_Bool *cab_keyCabEnabled2;
CB_Mem_Bool *cab_keyCabDisabled2;
CB_Mem_Bool *cab_enableOpeningRightC1;
CB_Mem_Bool *cab_enableOpeningLeftC1;
CB_Mem_Bool *cab_enableClosingRightC1;
CB_Mem_Bool *cab_enableClosingLeftC1;
CB_Mem_Bool *cab_cabEnabled;
CB_Mem_Bool *cab_cabDisabled;
CB_Mem_Bool *cab_cabIncoherence;

/**************************** Variables *****************************/



/************************ Components offsets ************************/

static CB_Offset tni_train__cab_offset_key2position;
static CB_Offset tni_train__cab_offset_service_side;
static CB_Offset tni_train__cab_offset_closingPB;
static CB_Offset tni_train__cab_offset_trainSpeed;
static CB_Offset tni_train__cab_offset_cabControlPart;
static CB_Offset tni_train__cab_offset__end = {0, 0, 0, 0};


/********************* Initialization function **********************/

int _tni_train__cab_init(void)
{
	CB_Object __start = self;
	self.Bool+=5;
	self.Float+=1;

	/*initialize child key2position (tni_train.key2position):*/
	self_num++;
	tni_train__cab_offset_key2position.Bool = self.Bool - __start.Bool;
	tni_train__cab_offset_key2position.Int = self.Int - __start.Int;
	tni_train__cab_offset_key2position.Float = self.Float - __start.Float;
	tni_train__cab_offset_key2position.Char = self.Char - __start.Char;
	key2position_keyCabEnabled = __start.Bool+0; /*cab__cn_6*/
	key2position_keyCabDisabled = __start.Bool+1; /*cab__cn_5*/
	_tni_train__key2position_init();

	/*initialize child service_side (tni_train.service_side):*/
	self_num++;
	tni_train__cab_offset_service_side.Bool = self.Bool - __start.Bool;
	tni_train__cab_offset_service_side.Int = self.Int - __start.Int;
	tni_train__cab_offset_service_side.Float = self.Float - __start.Float;
	tni_train__cab_offset_service_side.Char = self.Char - __start.Char;
	service_side_rightServiceSide = __start.Bool+2; /*cab__cn_4*/
	service_side_leftServiceSide = __start.Bool+3; /*cab__cn_3*/
	_tni_train__service_side_init();

	/*initialize child closingPB (tni_train.pb):*/
	self_num++;
	tni_train__cab_offset_closingPB.Bool = self.Bool - __start.Bool;
	tni_train__cab_offset_closingPB.Int = self.Int - __start.Int;
	tni_train__cab_offset_closingPB.Float = self.Float - __start.Float;
	tni_train__cab_offset_closingPB.Char = self.Char - __start.Char;
	pb_PB = __start.Bool+4; /*cab__cn_2*/
	_tni_train__pb_init();

	/*initialize child trainSpeed (tni_train.speed):*/
	self_num++;
	tni_train__cab_offset_trainSpeed.Bool = self.Bool - __start.Bool;
	tni_train__cab_offset_trainSpeed.Int = self.Int - __start.Int;
	tni_train__cab_offset_trainSpeed.Float = self.Float - __start.Float;
	tni_train__cab_offset_trainSpeed.Char = self.Char - __start.Char;
	speed_speed = __start.Float+0; /*cab__cn_1*/
	_tni_train__speed_init();

	/*initialize child cabControlPart (tni_train.cp_cab):*/
	self_num++;
	tni_train__cab_offset_cabControlPart.Bool = self.Bool - __start.Bool;
	tni_train__cab_offset_cabControlPart.Int = self.Int - __start.Int;
	tni_train__cab_offset_cabControlPart.Float = self.Float - __start.Float;
	tni_train__cab_offset_cabControlPart.Char = self.Char - __start.Char;
	cp_cab_keyCabEnabled = __start.Bool+0; /*cab__cn_6*/
	cp_cab_keyCabDisabled = __start.Bool+1; /*cab__cn_5*/
	cp_cab_rightServiceSide = __start.Bool+2; /*cab__cn_4*/
	cp_cab_leftServiceSide = __start.Bool+3; /*cab__cn_3*/
	cp_cab_pbDoorClosing = __start.Bool+4; /*cab__cn_2*/
	cp_cab_speed = __start.Float+0; /*cab__cn_1*/
	cp_cab_keyCabEnabled2 = cab_keyCabEnabled2;
	cp_cab_keyCabDisabled2 = cab_keyCabDisabled2;
	cp_cab_enableOpeningRightC1 = cab_enableOpeningRightC1;
	cp_cab_enableOpeningLeftC1 = cab_enableOpeningLeftC1;
	cp_cab_enableClosingRightC1 = cab_enableClosingRightC1;
	cp_cab_enableClosingLeftC1 = cab_enableClosingLeftC1;
	cp_cab_cabEnabled = cab_cabEnabled;
	cp_cab_cabDisabled = cab_cabDisabled;
	cp_cab_cabIncoherence = cab_cabIncoherence;
	_tni_train__cp_cab_init();

	tni_train__cab_offset__end.Bool = self.Bool - __start.Bool;
	tni_train__cab_offset__end.Int = self.Int - __start.Int;
	tni_train__cab_offset__end.Float = self.Float - __start.Float;
	tni_train__cab_offset__end.Char = self.Char - __start.Char;

	return 0;
}


/************************ Behavior function *************************/

int tni_train__cab(void)
{
	CB_Object __start = self;
	int __ret;
	if (exec_mac_node(self_num)) {

		/*********************** Internals variables ************************/

												
		/********************* Pre-conditions execution *********************/

		/*no Pre-conditions*/

		/************************ Behavior execution ************************/

		{
			self.Bool = __start.Bool + tni_train__cab_offset_key2position.Bool;
			self.Int = __start.Int + tni_train__cab_offset_key2position.Int;
			self.Float = __start.Float + tni_train__cab_offset_key2position.Float;
			self.Char = __start.Char + tni_train__cab_offset_key2position.Char;

			/********************** key2position execution **********************/

			self_num++;
			if (key2position__num != self_num) {
				key2position__num = self_num;
				key2position_keyCabEnabled = __start.Bool+0; /*cab__cn_6*/
				key2position_keyCabDisabled = __start.Bool+1; /*cab__cn_5*/
			}
			__ret = tni_train__key2position();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

			/********************** service_side execution **********************/

			self_num++;
			if (service_side__num != self_num) {
				service_side__num = self_num;
				service_side_rightServiceSide = __start.Bool+2; /*cab__cn_4*/
				service_side_leftServiceSide = __start.Bool+3; /*cab__cn_3*/
			}
			__ret = tni_train__service_side();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

			/*********************** closingPB execution ************************/

			self_num++;
			if (pb__num != self_num) {
				pb__num = self_num;
				pb_PB = __start.Bool+4; /*cab__cn_2*/
			}
			__ret = tni_train__pb();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

			/*********************** trainSpeed execution ***********************/

			self_num++;
			if (speed__num != self_num) {
				speed__num = self_num;
				speed_speed = __start.Float+0; /*cab__cn_1*/
			}
			__ret = tni_train__speed();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

			/********************* cabControlPart execution *********************/

			self_num++;
			if (cp_cab__num != self_num) {
				cp_cab__num = self_num;
				cp_cab_keyCabEnabled = __start.Bool+0; /*cab__cn_6*/
				cp_cab_keyCabDisabled = __start.Bool+1; /*cab__cn_5*/
				cp_cab_rightServiceSide = __start.Bool+2; /*cab__cn_4*/
				cp_cab_leftServiceSide = __start.Bool+3; /*cab__cn_3*/
				cp_cab_pbDoorClosing = __start.Bool+4; /*cab__cn_2*/
				cp_cab_speed = __start.Float+0; /*cab__cn_1*/
				cp_cab_keyCabEnabled2 = cab_keyCabEnabled2;
				cp_cab_keyCabDisabled2 = cab_keyCabDisabled2;
				cp_cab_enableOpeningRightC1 = cab_enableOpeningRightC1;
				cp_cab_enableOpeningLeftC1 = cab_enableOpeningLeftC1;
				cp_cab_enableClosingRightC1 = cab_enableClosingRightC1;
				cp_cab_enableClosingLeftC1 = cab_enableClosingLeftC1;
				cp_cab_cabEnabled = cab_cabEnabled;
				cp_cab_cabDisabled = cab_cabDisabled;
				cp_cab_cabIncoherence = cab_cabIncoherence;
			}
			__ret = tni_train__cp_cab();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

		}


		/******************** Post-conditions execution *********************/

		/*no Post-conditions*/
	}

	/*************************** self update ****************************/

	self.Bool = __start.Bool + tni_train__cab_offset__end.Bool;
	self.Int = __start.Int + tni_train__cab_offset__end.Int;
	self.Float = __start.Float + tni_train__cab_offset__end.Float;
	self.Char = __start.Char + tni_train__cab_offset__end.Char;

	return 0;
}

