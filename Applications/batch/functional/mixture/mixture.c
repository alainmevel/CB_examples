/*2023-10-03T11:13:39-01:00*/

/********************************************************************
 * mixture.c
 * 
 * generated by: plcgen 3.1.391
 ********************************************************************/

#include "cb_comp.h"
#include "iec_1131.h"


/********************************************************************
 *                   Inner 'faults' declarations                    *
 ********************************************************************/


/********************** Variable declarations ***********************/

static CB_Index faults__num;
extern CB_Mem_Bool *_i_mixture__faults_generalFault1;
extern CB_Mem_Bool *_i_mixture__faults_generalFault2;
extern CB_Mem_Bool *_i_mixture__faults_generalFault3;
extern CB_Mem_Bool *_i_mixture__faults_fault;

/********************** Function declarations ***********************/

static int _batch__faults_init(void);
static int batch__faults(void);

/********************************************************************
 *                  Inner 'faults' implementation                   *
 ********************************************************************/



/**************************** Variables *****************************/

static CB_Index faults__num = 0;
CB_Mem_Bool *_i_mixture__faults_generalFault1;
CB_Mem_Bool *_i_mixture__faults_generalFault2;
CB_Mem_Bool *_i_mixture__faults_generalFault3;
CB_Mem_Bool *_i_mixture__faults_fault;

/**************************** Variables *****************************/

#define generalFault1 (_i_mixture__faults_generalFault1->CB_current_value)
#define generalFault2 (_i_mixture__faults_generalFault2->CB_current_value)
#define generalFault3 (_i_mixture__faults_generalFault3->CB_current_value)
#define fault (_i_mixture__faults_fault->CB_current_value)


/************************ Components offsets ************************/


/********************* Initialization function **********************/

static int _batch__faults_init(void)
{


	return 0;
}


/************************ Behavior function *************************/

static int batch__faults(void)
{
	if (exec_term_node(self_num)) {

		/*********************** Internals variables ************************/


		/********************* Pre-conditions execution *********************/

		/*no Pre-conditions*/

		/************************ Behavior execution ************************/

		{
			fault = (generalFault3 || generalFault1) || generalFault2;
		}

		CB_post_bool(_i_mixture__faults_fault);

		/******************** Post-conditions execution *********************/

		/*no Post-conditions*/
	}

	/*************************** self update ****************************/


	return 0;
}

#undef generalFault1
#undef generalFault2
#undef generalFault3
#undef fault

/********************************************************************
 *              Public 'batch.mixture' implementation               *
 ********************************************************************/

#include "mixture.h"
#include "batch/functional/add_syrup/add_syrup.h"
#include "equipment_library/functional/flow_compute/flow_compute.h"
#include "batch/functional/kneading/kneading.h"
#include "io_library/functional/io_agitator_1speed/io_agitator_1speed.h"
#include "io_library/functional/io_on_off_valve/io_on_off_valve.h"
#include "equipment_library/functional/tank/tank.h"
#include "equipment_library/functional/analog_sensor/analog_sensor.h"
#include "equipment_library/functional/bounded_scale/bounded_scale.h"


/**************************** Variables *****************************/

CB_Index mixture__num = 0;
CB_Mem_Bool *mixture_cycleInProgress;
CB_Mem_Bool *mixture_kneadingRequest;
CB_Mem_Bool *mixture_acknowledgePB;
CB_Mem_Bool *mixture_autoMode;
CB_Mem_Bool *mixture_manualMode;
CB_Mem_Float *mixture_syrupExtraction;
CB_Mem_Float *mixture_flourExtraction;
CB_Mem_Bool *mixture_kneadingOK;
CB_Mem_Bool *mixture_fault;

/**************************** Variables *****************************/



/************************ Components offsets ************************/

static CB_Offset batch__mixture_offset_collectedMixture;
static CB_Offset batch__mixture_offset_flow;
static CB_Offset batch__mixture_offset_kneading;
static CB_Offset batch__mixture_offset_motorOfAgitator;
static CB_Offset batch__mixture_offset_cleaningValve;
static CB_Offset batch__mixture_offset_mixtureExtractingValve;
static CB_Offset batch__mixture_offset_mixtureWeighing;
static CB_Offset batch__mixture_offset_faults1;
static CB_Offset batch__mixture_offset_level;
static CB_Offset batch__mixture_offset_scale;
static CB_Offset batch__mixture_offset__end = {0, 0, 0, 0};


/********************* Initialization function **********************/

int _batch__mixture_init(void)
{
	CB_Object __start = self;
	self.Bool+=13;
	self.Int+=2;
	self.Float+=15;

	/*initialize child collectedMixture (batch.add_syrup):*/
	self_num++;
	batch__mixture_offset_collectedMixture.Bool = self.Bool - __start.Bool;
	batch__mixture_offset_collectedMixture.Int = self.Int - __start.Int;
	batch__mixture_offset_collectedMixture.Float = self.Float - __start.Float;
	batch__mixture_offset_collectedMixture.Char = self.Char - __start.Char;
	add_syrup_flowSyrup1 = mixture_syrupExtraction;
	add_syrup_flowSyrup2 = mixture_flourExtraction;
	add_syrup_flowSyrup3 = __start.Float+9; /*mixture__cn_15*/
	add_syrup_flow = __start.Float+12; /*mixture__cn_6*/
	_batch__add_syrup_init();

	/*initialize child flow (equipment_library.flow_compute):*/
	self_num++;
	batch__mixture_offset_flow.Bool = self.Bool - __start.Bool;
	batch__mixture_offset_flow.Int = self.Int - __start.Int;
	batch__mixture_offset_flow.Float = self.Float - __start.Float;
	batch__mixture_offset_flow.Char = self.Char - __start.Char;
	flow_compute_inputFlow = __start.Float+10; /*mixture__cn_14*/
	flow_compute_outputFlow = __start.Float+11; /*mixture__cn_7*/
	_equipment_library__flow_compute_init();

	/*initialize child kneading (batch.kneading):*/
	self_num++;
	batch__mixture_offset_kneading.Bool = self.Bool - __start.Bool;
	batch__mixture_offset_kneading.Int = self.Int - __start.Int;
	batch__mixture_offset_kneading.Float = self.Float - __start.Float;
	batch__mixture_offset_kneading.Char = self.Char - __start.Char;
	kneading_kneadingRequest = mixture_kneadingRequest;
	kneading_cycleInProgress = mixture_cycleInProgress;
	kneading_mixtureLevel = __start.Int+1; /*mixture__cn_13*/
	kneading_kneadingOK = mixture_kneadingOK;
	kneading_knead = __start.Bool+5; /*mixture__cn_12*/
	kneading_clean = __start.Bool+7; /*mixture__cn_10*/
	kneading_cleaningEnd = __start.Bool+6; /*mixture__cn_11*/
	kneading_evacuateMixture = __start.Bool+9; /*mixture__cn_8*/
	kneading_evacMixtureEnd = __start.Bool+8; /*mixture__cn_9*/
	_batch__kneading_init();

	/*initialize child motorOfAgitator (io_library.io_agitator_1speed):*/
	self_num++;
	batch__mixture_offset_motorOfAgitator.Bool = self.Bool - __start.Bool;
	batch__mixture_offset_motorOfAgitator.Int = self.Int - __start.Int;
	batch__mixture_offset_motorOfAgitator.Float = self.Float - __start.Float;
	batch__mixture_offset_motorOfAgitator.Char = self.Char - __start.Char;
	io_agitator_1speed_acknowledgePB = mixture_acknowledgePB;
	io_agitator_1speed_autoMode = mixture_autoMode;
	io_agitator_1speed_manualMode = mixture_manualMode;
	io_agitator_1speed_autoCmd = __start.Bool+5; /*mixture__cn_12*/
	io_agitator_1speed_generalFault = __start.Bool+10; /*mixture__cn_4*/
	io_agitator_1speed_speedVal = __start.Float+8; /*mixture__cn_16*/
	io_agitator_1speed_speedPercent = __start.Float+7; /*mixture__cn_17*/
	_io_library__io_agitator_1speed_init();

	/*initialize child cleaningValve (io_library.io_on_off_valve):*/
	self_num++;
	batch__mixture_offset_cleaningValve.Bool = self.Bool - __start.Bool;
	batch__mixture_offset_cleaningValve.Int = self.Int - __start.Int;
	batch__mixture_offset_cleaningValve.Float = self.Float - __start.Float;
	batch__mixture_offset_cleaningValve.Char = self.Char - __start.Char;
	io_on_off_valve_acknowledgePB = mixture_acknowledgePB;
	io_on_off_valve_autoMode = mixture_autoMode;
	io_on_off_valve_manualMode = mixture_manualMode;
	io_on_off_valve_autoCloseCmd = __start.Bool+6; /*mixture__cn_11*/
	io_on_off_valve_autoOpenCmd = __start.Bool+7; /*mixture__cn_10*/
	io_on_off_valve_inputFlow = __start.Float+6; /*mixture__cn_18*/
	io_on_off_valve_openedSensor = __start.Bool+4; /*mixture__cn_19*/
	io_on_off_valve_closedSensor = __start.Bool+3; /*mixture__cn_20*/
	io_on_off_valve_generalFault = __start.Bool+11; /*mixture__cn_3*/
	io_on_off_valve_outputFlow = __start.Float+5; /*mixture__cn_21*/
	io_on_off_valve_percentOpening = __start.Float+4; /*mixture__cn_22*/
	_io_library__io_on_off_valve_init();

	/*initialize child mixtureExtractingValve (io_library.io_on_off_valve):*/
	self_num++;
	batch__mixture_offset_mixtureExtractingValve.Bool = self.Bool - __start.Bool;
	batch__mixture_offset_mixtureExtractingValve.Int = self.Int - __start.Int;
	batch__mixture_offset_mixtureExtractingValve.Float = self.Float - __start.Float;
	batch__mixture_offset_mixtureExtractingValve.Char = self.Char - __start.Char;
	io_on_off_valve_acknowledgePB = mixture_acknowledgePB;
	io_on_off_valve_autoMode = mixture_autoMode;
	io_on_off_valve_manualMode = mixture_manualMode;
	io_on_off_valve_autoCloseCmd = __start.Bool+8; /*mixture__cn_9*/
	io_on_off_valve_autoOpenCmd = __start.Bool+9; /*mixture__cn_8*/
	io_on_off_valve_inputFlow = __start.Float+11; /*mixture__cn_7*/
	io_on_off_valve_openedSensor = __start.Bool+2; /*mixture__cn_23*/
	io_on_off_valve_closedSensor = __start.Bool+1; /*mixture__cn_24*/
	io_on_off_valve_generalFault = __start.Bool+12; /*mixture__cn_2*/
	io_on_off_valve_outputFlow = __start.Float+13; /*mixture__cn_5*/
	io_on_off_valve_percentOpening = __start.Float+3; /*mixture__cn_25*/
	_io_library__io_on_off_valve_init();

	/*initialize child mixtureWeighing (equipment_library.tank):*/
	self_num++;
	batch__mixture_offset_mixtureWeighing.Bool = self.Bool - __start.Bool;
	batch__mixture_offset_mixtureWeighing.Int = self.Int - __start.Int;
	batch__mixture_offset_mixtureWeighing.Float = self.Float - __start.Float;
	batch__mixture_offset_mixtureWeighing.Char = self.Char - __start.Char;
	tank_inletFlow = __start.Float+12; /*mixture__cn_6*/
	tank_outletFlow = __start.Float+13; /*mixture__cn_5*/
	tank_tankLevel = __start.Float+10; /*mixture__cn_14*/
	_equipment_library__tank_init();

	/*initialize child faults1 (batch.faults):*/
	self_num++;
	batch__mixture_offset_faults1.Bool = self.Bool - __start.Bool;
	batch__mixture_offset_faults1.Int = self.Int - __start.Int;
	batch__mixture_offset_faults1.Float = self.Float - __start.Float;
	batch__mixture_offset_faults1.Char = self.Char - __start.Char;
	_i_mixture__faults_generalFault1 = __start.Bool+10; /*mixture__cn_4*/
	_i_mixture__faults_generalFault2 = __start.Bool+11; /*mixture__cn_3*/
	_i_mixture__faults_generalFault3 = __start.Bool+12; /*mixture__cn_2*/
	_i_mixture__faults_fault = mixture_fault;
	_batch__faults_init();

	/*initialize child level (equipment_library.analog_sensor):*/
	self_num++;
	batch__mixture_offset_level.Bool = self.Bool - __start.Bool;
	batch__mixture_offset_level.Int = self.Int - __start.Int;
	batch__mixture_offset_level.Float = self.Float - __start.Float;
	batch__mixture_offset_level.Char = self.Char - __start.Char;
	analog_sensor_measure = __start.Float+10; /*mixture__cn_14*/
	analog_sensor_sensorSupply = __start.Bool+0; /*mixture__cn_26*/
	analog_sensor_realValue = __start.Float+14; /*mixture__cn_1*/
	analog_sensor_intValue = __start.Float+2; /*mixture__cn_27*/
	analog_sensor_dintValue = __start.Float+1; /*mixture__cn_28*/
	_equipment_library__analog_sensor_init();

	/*initialize child scale (equipment_library.bounded_scale):*/
	self_num++;
	batch__mixture_offset_scale.Bool = self.Bool - __start.Bool;
	batch__mixture_offset_scale.Int = self.Int - __start.Int;
	batch__mixture_offset_scale.Float = self.Float - __start.Float;
	batch__mixture_offset_scale.Char = self.Char - __start.Char;
	bounded_scale_inputValue = __start.Float+14; /*mixture__cn_1*/
	bounded_scale_realValue = __start.Float+0; /*mixture__cn_29*/
	bounded_scale_dintValue = __start.Int+1; /*mixture__cn_13*/
	bounded_scale_intValue = __start.Int+0; /*mixture__cn_30*/
	_equipment_library__bounded_scale_init();

	batch__mixture_offset__end.Bool = self.Bool - __start.Bool;
	batch__mixture_offset__end.Int = self.Int - __start.Int;
	batch__mixture_offset__end.Float = self.Float - __start.Float;
	batch__mixture_offset__end.Char = self.Char - __start.Char;

	return 0;
}


/************************ Behavior function *************************/

int batch__mixture(void)
{
	CB_Object __start = self;
	int __ret;
	if (exec_mac_node(self_num)) {

		/*********************** Internals variables ************************/

																																																												
		/********************* Pre-conditions execution *********************/

		/*no Pre-conditions*/

		/************************ Behavior execution ************************/

		{
			self.Bool = __start.Bool + batch__mixture_offset_collectedMixture.Bool;
			self.Int = __start.Int + batch__mixture_offset_collectedMixture.Int;
			self.Float = __start.Float + batch__mixture_offset_collectedMixture.Float;
			self.Char = __start.Char + batch__mixture_offset_collectedMixture.Char;

			/******************** collectedMixture execution ********************/

			self_num++;
			if (add_syrup__num != self_num) {
				add_syrup__num = self_num;
				add_syrup_flowSyrup1 = mixture_syrupExtraction;
				add_syrup_flowSyrup2 = mixture_flourExtraction;
				add_syrup_flowSyrup3 = __start.Float+9; /*mixture__cn_15*/
				add_syrup_flow = __start.Float+12; /*mixture__cn_6*/
			}
			__ret = batch__add_syrup();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

			/************************** flow execution **************************/

			self_num++;
			if (flow_compute__num != self_num) {
				flow_compute__num = self_num;
				flow_compute_inputFlow = __start.Float+10; /*mixture__cn_14*/
				flow_compute_outputFlow = __start.Float+11; /*mixture__cn_7*/
			}
			__ret = equipment_library__flow_compute();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

			/************************ kneading execution ************************/

			self_num++;
			if (kneading__num != self_num) {
				kneading__num = self_num;
				kneading_kneadingRequest = mixture_kneadingRequest;
				kneading_cycleInProgress = mixture_cycleInProgress;
				kneading_mixtureLevel = __start.Int+1; /*mixture__cn_13*/
				kneading_kneadingOK = mixture_kneadingOK;
				kneading_knead = __start.Bool+5; /*mixture__cn_12*/
				kneading_clean = __start.Bool+7; /*mixture__cn_10*/
				kneading_cleaningEnd = __start.Bool+6; /*mixture__cn_11*/
				kneading_evacuateMixture = __start.Bool+9; /*mixture__cn_8*/
				kneading_evacMixtureEnd = __start.Bool+8; /*mixture__cn_9*/
			}
			__ret = batch__kneading();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

			/******************** motorOfAgitator execution *********************/

			self_num++;
			if (io_agitator_1speed__num != self_num) {
				io_agitator_1speed__num = self_num;
				io_agitator_1speed_acknowledgePB = mixture_acknowledgePB;
				io_agitator_1speed_autoMode = mixture_autoMode;
				io_agitator_1speed_manualMode = mixture_manualMode;
				io_agitator_1speed_autoCmd = __start.Bool+5; /*mixture__cn_12*/
				io_agitator_1speed_generalFault = __start.Bool+10; /*mixture__cn_4*/
				io_agitator_1speed_speedVal = __start.Float+8; /*mixture__cn_16*/
				io_agitator_1speed_speedPercent = __start.Float+7; /*mixture__cn_17*/
			}
			__ret = io_library__io_agitator_1speed();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

			/********************* cleaningValve execution **********************/

			self_num++;
			if (io_on_off_valve__num != self_num) {
				io_on_off_valve__num = self_num;
				io_on_off_valve_acknowledgePB = mixture_acknowledgePB;
				io_on_off_valve_autoMode = mixture_autoMode;
				io_on_off_valve_manualMode = mixture_manualMode;
				io_on_off_valve_autoCloseCmd = __start.Bool+6; /*mixture__cn_11*/
				io_on_off_valve_autoOpenCmd = __start.Bool+7; /*mixture__cn_10*/
				io_on_off_valve_inputFlow = __start.Float+6; /*mixture__cn_18*/
				io_on_off_valve_openedSensor = __start.Bool+4; /*mixture__cn_19*/
				io_on_off_valve_closedSensor = __start.Bool+3; /*mixture__cn_20*/
				io_on_off_valve_generalFault = __start.Bool+11; /*mixture__cn_3*/
				io_on_off_valve_outputFlow = __start.Float+5; /*mixture__cn_21*/
				io_on_off_valve_percentOpening = __start.Float+4; /*mixture__cn_22*/
			}
			__ret = io_library__io_on_off_valve();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

			/***************** mixtureExtractingValve execution *****************/

			self_num++;
			if (io_on_off_valve__num != self_num) {
				io_on_off_valve__num = self_num;
				io_on_off_valve_acknowledgePB = mixture_acknowledgePB;
				io_on_off_valve_autoMode = mixture_autoMode;
				io_on_off_valve_manualMode = mixture_manualMode;
				io_on_off_valve_autoCloseCmd = __start.Bool+8; /*mixture__cn_9*/
				io_on_off_valve_autoOpenCmd = __start.Bool+9; /*mixture__cn_8*/
				io_on_off_valve_inputFlow = __start.Float+11; /*mixture__cn_7*/
				io_on_off_valve_openedSensor = __start.Bool+2; /*mixture__cn_23*/
				io_on_off_valve_closedSensor = __start.Bool+1; /*mixture__cn_24*/
				io_on_off_valve_generalFault = __start.Bool+12; /*mixture__cn_2*/
				io_on_off_valve_outputFlow = __start.Float+13; /*mixture__cn_5*/
				io_on_off_valve_percentOpening = __start.Float+3; /*mixture__cn_25*/
			}
			__ret = io_library__io_on_off_valve();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

			/******************** mixtureWeighing execution *********************/

			self_num++;
			if (tank__num != self_num) {
				tank__num = self_num;
				tank_inletFlow = __start.Float+12; /*mixture__cn_6*/
				tank_outletFlow = __start.Float+13; /*mixture__cn_5*/
				tank_tankLevel = __start.Float+10; /*mixture__cn_14*/
			}
			__ret = equipment_library__tank();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

			/************************ faults1 execution *************************/

			self_num++;
			if (faults__num != self_num) {
				faults__num = self_num;
				_i_mixture__faults_generalFault1 = __start.Bool+10; /*mixture__cn_4*/
				_i_mixture__faults_generalFault2 = __start.Bool+11; /*mixture__cn_3*/
				_i_mixture__faults_generalFault3 = __start.Bool+12; /*mixture__cn_2*/
				_i_mixture__faults_fault = mixture_fault;
			}
			__ret = batch__faults();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

			/************************* level execution **************************/

			self_num++;
			if (analog_sensor__num != self_num) {
				analog_sensor__num = self_num;
				analog_sensor_measure = __start.Float+10; /*mixture__cn_14*/
				analog_sensor_sensorSupply = __start.Bool+0; /*mixture__cn_26*/
				analog_sensor_realValue = __start.Float+14; /*mixture__cn_1*/
				analog_sensor_intValue = __start.Float+2; /*mixture__cn_27*/
				analog_sensor_dintValue = __start.Float+1; /*mixture__cn_28*/
			}
			__ret = equipment_library__analog_sensor();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

			/************************* scale execution **************************/

			self_num++;
			if (bounded_scale__num != self_num) {
				bounded_scale__num = self_num;
				bounded_scale_inputValue = __start.Float+14; /*mixture__cn_1*/
				bounded_scale_realValue = __start.Float+0; /*mixture__cn_29*/
				bounded_scale_dintValue = __start.Int+1; /*mixture__cn_13*/
				bounded_scale_intValue = __start.Int+0; /*mixture__cn_30*/
			}
			__ret = equipment_library__bounded_scale();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

		}


		/******************** Post-conditions execution *********************/

		/*no Post-conditions*/
	}

	/*************************** self update ****************************/

	self.Bool = __start.Bool + batch__mixture_offset__end.Bool;
	self.Int = __start.Int + batch__mixture_offset__end.Int;
	self.Float = __start.Float + batch__mixture_offset__end.Float;
	self.Char = __start.Char + batch__mixture_offset__end.Char;

	return 0;
}

