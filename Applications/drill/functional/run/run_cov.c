/*2023-10-03T11:13:44-01:00*/

/********************************************************************
 * run_cov.c
 * 
 * generated by: plcgen 3.1.391
 ********************************************************************/

#include "cb_comp.h"
#include "cb_covs.h"
#include "iec_1131.h"

#include "run.h"


/**************************** Variables *****************************/

CB_Index run__num = 0;
CB_Mem_Int *run_rotationFault;
CB_Mem_Bool *run_downState;
CB_Mem_Bool *run_downDeceleration;
CB_Mem_Bool *run_topDeceleration;
CB_Mem_Bool *run_topState;
CB_Mem_Int *run_motorFault;
CB_Mem_Int *run_clampingFault;
CB_Mem_Bool *run_releasingOK;
CB_Mem_Bool *run_clampingOK;
CB_Mem_Bool *run_emptyProd;
CB_Mem_Bool *run_unitProd;
CB_Mem_Bool *run_batchProd;
CB_Mem_Bool *run_acknowledgePB;
CB_Mem_Bool *run_piece;
CB_Mem_Bool *run_rotation;
CB_Mem_Bool *run_cycleEnd;
CB_Mem_Int *run_movementFault;
CB_Mem_Bool *run_loadingRequest;
CB_Mem_Bool *run_unloadingRequest;
CB_Mem_Bool *run_faultyState;
CB_Mem_Bool *run_slowAscent;
CB_Mem_Bool *run_fastAscent;
CB_Mem_Bool *run_slowDescent;
CB_Mem_Bool *run_fastDescent;
CB_Mem_Bool *run_releasing;
CB_Mem_Bool *run_clamping;
CB_Mem_Bool *run_initialCond;
CB_Mem_Bool *run_noFaultCond;
CB_Mem_Int *run_cnt;
CB_Mem_Int *run_fastDescentDuration;
CB_Mem_Int *run_slowDescentDuration;
CB_Mem_Int *run_fastAscentDuration;
CB_Mem_Int *run_slowAscentDuration;
CB_Mem_Bool *run__X_10;
CB_Mem_Bool *run__X_11;
CB_Mem_Bool *run__X_12;
CB_Mem_Bool *run__X_13;
CB_Mem_Bool *run__X_14;
CB_Mem_Bool *run__X_15;
CB_Mem_Bool *run__X_16;
CB_Mem_Bool *run__X_17;
CB_Mem_Bool *run_acknowledgePB_PREV;
CB_Mem_Int *run_acknowledgePB_EDGE;
CB_Mem_Bool *run_unitProd_PREV;
CB_Mem_Int *run_unitProd_EDGE;
CB_Mem_Bool *run__X_10_PREV;
CB_Mem_Bool *run__X_11_PREV;
CB_Mem_Bool *run__X_12_PREV;
CB_Mem_Bool *run__X_13_PREV;
CB_Mem_Bool *run__X_14_PREV;
CB_Mem_Bool *run__X_15_PREV;
CB_Mem_Bool *run__X_16_PREV;
CB_Mem_Bool *run__X_17_PREV;

/**************************** Variables *****************************/

#define rotationFault (run_rotationFault->CB_current_value)
#define downState (run_downState->CB_current_value)
#define downDeceleration (run_downDeceleration->CB_current_value)
#define topDeceleration (run_topDeceleration->CB_current_value)
#define topState (run_topState->CB_current_value)
#define motorFault (run_motorFault->CB_current_value)
#define clampingFault (run_clampingFault->CB_current_value)
#define releasingOK (run_releasingOK->CB_current_value)
#define clampingOK (run_clampingOK->CB_current_value)
#define emptyProd (run_emptyProd->CB_current_value)
#define unitProd (run_unitProd->CB_current_value)
#define batchProd (run_batchProd->CB_current_value)
#define acknowledgePB (run_acknowledgePB->CB_current_value)
#define piece (run_piece->CB_current_value)
#define rotation (run_rotation->CB_current_value)
#define cycleEnd (run_cycleEnd->CB_current_value)
#define movementFault (run_movementFault->CB_current_value)
#define loadingRequest (run_loadingRequest->CB_current_value)
#define unloadingRequest (run_unloadingRequest->CB_current_value)
#define faultyState (run_faultyState->CB_current_value)
#define slowAscent (run_slowAscent->CB_current_value)
#define fastAscent (run_fastAscent->CB_current_value)
#define slowDescent (run_slowDescent->CB_current_value)
#define fastDescent (run_fastDescent->CB_current_value)
#define releasing (run_releasing->CB_current_value)
#define clamping (run_clamping->CB_current_value)
#define initialCond (run_initialCond->CB_current_value)
#define noFaultCond (run_noFaultCond->CB_current_value)
#define cnt (run_cnt->CB_current_value)
#define fastDescentDuration (run_fastDescentDuration->CB_current_value)
#define slowDescentDuration (run_slowDescentDuration->CB_current_value)
#define fastAscentDuration (run_fastAscentDuration->CB_current_value)
#define slowAscentDuration (run_slowAscentDuration->CB_current_value)
#define _X_10 (run__X_10->CB_current_value)
#define _X_11 (run__X_11->CB_current_value)
#define _X_12 (run__X_12->CB_current_value)
#define _X_13 (run__X_13->CB_current_value)
#define _X_14 (run__X_14->CB_current_value)
#define _X_15 (run__X_15->CB_current_value)
#define _X_16 (run__X_16->CB_current_value)
#define _X_17 (run__X_17->CB_current_value)
#define acknowledgePB_PREV (run_acknowledgePB_PREV->CB_current_value)
#define acknowledgePB_EDGE (run_acknowledgePB_EDGE->CB_current_value)
#define unitProd_PREV (run_unitProd_PREV->CB_current_value)
#define unitProd_EDGE (run_unitProd_EDGE->CB_current_value)
#define _X_10_PREV (run__X_10_PREV->CB_current_value)
#define _X_11_PREV (run__X_11_PREV->CB_current_value)
#define _X_12_PREV (run__X_12_PREV->CB_current_value)
#define _X_13_PREV (run__X_13_PREV->CB_current_value)
#define _X_14_PREV (run__X_14_PREV->CB_current_value)
#define _X_15_PREV (run__X_15_PREV->CB_current_value)
#define _X_16_PREV (run__X_16_PREV->CB_current_value)
#define _X_17_PREV (run__X_17_PREV->CB_current_value)


/************************ Components offsets ************************/


/********************* Initialization function **********************/

int _drill__run_init(void)
{
	(self.Int+1)->CB_current_value = 100; /*fastDescentDuration*/
	(self.Int+2)->CB_current_value = 50; /*slowDescentDuration*/
	(self.Int+3)->CB_current_value = 100; /*fastAscentDuration*/
	(self.Int+4)->CB_current_value = 50; /*slowAscentDuration*/
	(self.Bool+2)->CB_current_value = 1; /*_X_10*/
	(self.Bool+12)->CB_current_value = 1; /*_X_10_PREV*/
	self.Bool+=20;
	self.Int+=7;


	return 0;
}


/************************ Behavior function *************************/

int drill__run(void)
{
	static char *__comp_name = "drill.run";
	if (exec_term_node(self_num)) {

		/*********************** Internals variables ************************/

		run_initialCond = self.Bool+0;
		run_noFaultCond = self.Bool+1;
		run_cnt = self.Int+0;
		run_fastDescentDuration = self.Int+1;
		run_slowDescentDuration = self.Int+2;
		run_fastAscentDuration = self.Int+3;
		run_slowAscentDuration = self.Int+4;
		run__X_10 = self.Bool+2;
		run__X_11 = self.Bool+3;
		run__X_12 = self.Bool+4;
		run__X_13 = self.Bool+5;
		run__X_14 = self.Bool+6;
		run__X_15 = self.Bool+7;
		run__X_16 = self.Bool+8;
		run__X_17 = self.Bool+9;
		run_acknowledgePB_PREV = self.Bool+10;
		run_acknowledgePB_EDGE = self.Int+5;
		run_unitProd_PREV = self.Bool+11;
		run_unitProd_EDGE = self.Int+6;
		run__X_10_PREV = self.Bool+12;
		run__X_11_PREV = self.Bool+13;
		run__X_12_PREV = self.Bool+14;
		run__X_13_PREV = self.Bool+15;
		run__X_14_PREV = self.Bool+16;
		run__X_15_PREV = self.Bool+17;
		run__X_16_PREV = self.Bool+18;
		run__X_17_PREV = self.Bool+19;

		/********************* Pre-conditions execution *********************/

		/*no Pre-conditions*/

		/************************ Behavior execution ************************/

		{
			unsigned char _Y_16;
			unsigned char _Y_15;
			unsigned char _Y_14;
			unsigned char _Y_13;
			unsigned char _Y_12;
			unsigned char _Y_11;
			unsigned char _Y_10;
			unsigned char _Y_9;
			acknowledgePB_EDGE = CB_edge_bool(acknowledgePB, acknowledgePB_PREV);
			unitProd_EDGE = CB_edge_bool(unitProd, unitProd_PREV);
			/*pre-SFC*/
			if (acknowledgePB_EDGE > 0) {
				cov_control_struct(__comp_name, self_num, INPRESFC, 1, IFTHEN);
				movementFault = 0;
			}
			else {
				cov_control_struct(__comp_name, self_num, INPRESFC, 1, IFELSE);
			}
			if ((_X_12 && (cnt >= fastDescentDuration)) && !downDeceleration) {
				cov_control_struct(__comp_name, self_num, INPRESFC, 4, IFTHEN);
				movementFault = 1;
			}
			else {
				cov_control_struct(__comp_name, self_num, INPRESFC, 4, IFELSE);
			}
			if ((_X_13 && (cnt >= slowDescentDuration)) && !downState) {
				cov_control_struct(__comp_name, self_num, INPRESFC, 7, IFTHEN);
				movementFault = 2;
			}
			else {
				cov_control_struct(__comp_name, self_num, INPRESFC, 7, IFELSE);
			}
			if ((_X_14 && (cnt >= fastAscentDuration)) && !topDeceleration) {
				cov_control_struct(__comp_name, self_num, INPRESFC, 10, IFTHEN);
				movementFault = 3;
			}
			else {
				cov_control_struct(__comp_name, self_num, INPRESFC, 10, IFELSE);
			}
			if ((_X_15 && (cnt >= slowAscentDuration)) && !topState) {
				cov_control_struct(__comp_name, self_num, INPRESFC, 13, IFTHEN);
				movementFault = 4;
			}
			else {
				cov_control_struct(__comp_name, self_num, INPRESFC, 13, IFELSE);
			}
			if ((_X_12 && downState) && !downDeceleration) {
				cov_control_struct(__comp_name, self_num, INPRESFC, 16, IFTHEN);
				movementFault = 5;
			}
			else {
				cov_control_struct(__comp_name, self_num, INPRESFC, 16, IFELSE);
			}
			if ((_X_14 && topState) && !topDeceleration) {
				cov_control_struct(__comp_name, self_num, INPRESFC, 19, IFTHEN);
				movementFault = 6;
			}
			else {
				cov_control_struct(__comp_name, self_num, INPRESFC, 19, IFELSE);
			}
			if ((_X_13 || _X_14) && topState) {
				cov_control_struct(__comp_name, self_num, INPRESFC, 22, IFTHEN);
				movementFault = 7;
			}
			else {
				cov_control_struct(__comp_name, self_num, INPRESFC, 22, IFELSE);
			}
			if ((((_X_11 || _X_13) || _X_16) || _X_17) && topDeceleration) {
				cov_control_struct(__comp_name, self_num, INPRESFC, 25, IFTHEN);
				movementFault = 8;
			}
			else {
				cov_control_struct(__comp_name, self_num, INPRESFC, 25, IFELSE);
			}
			if ((((_X_11 || _X_15) || _X_16) || _X_17) && downDeceleration) {
				cov_control_struct(__comp_name, self_num, INPRESFC, 28, IFTHEN);
				movementFault = 9;
			}
			else {
				cov_control_struct(__comp_name, self_num, INPRESFC, 28, IFELSE);
			}
			if ((((_X_11 || _X_15) || _X_16) || _X_17) && downState) {
				cov_control_struct(__comp_name, self_num, INPRESFC, 31, IFTHEN);
				movementFault = 10;
			}
			else {
				cov_control_struct(__comp_name, self_num, INPRESFC, 31, IFELSE);
			}
			noFaultCond = (((clampingFault == 0) && (motorFault == 0)) && (rotationFault == 0)) && (movementFault == 0);
			initialCond = noFaultCond && ((piece && ((unitProd_EDGE > 0) || batchProd)) || emptyProd);
			/*transitions G1*/
			_Y_16 = _X_10 && initialCond;
			_Y_15 = _X_11 && clampingOK;
			_Y_14 = _X_12 && downDeceleration;
			_Y_13 = _X_13 && downState;
			_Y_12 = _X_14 && topDeceleration;
			_Y_11 = _X_15 && topState;
			_Y_10 = _X_16 && releasingOK;
			_Y_9 = _X_17 && !piece;
			/*evolutions G1*/
			if (_Y_16) {
				_X_10 = 0;
			}
			if (_Y_15) {
				_X_11 = 0;
			}
			if (_Y_14) {
				_X_12 = 0;
			}
			if (_Y_13) {
				_X_13 = 0;
			}
			if (_Y_12) {
				_X_14 = 0;
			}
			if (_Y_11) {
				_X_15 = 0;
			}
			if (_Y_10) {
				_X_16 = 0;
			}
			if (_Y_9) {
				_X_17 = 0;
			}
			if (_Y_16) {
				_X_11 = 1;
			}
			if (_Y_15) {
				_X_12 = 1;
			}
			if (_Y_14) {
				_X_13 = 1;
			}
			if (_Y_13) {
				_X_14 = 1;
			}
			if (_Y_12) {
				_X_15 = 1;
			}
			if (_Y_11) {
				_X_16 = 1;
			}
			if (_Y_10) {
				_X_17 = 1;
			}
			if (_Y_9) {
				_X_10 = 1;
			}
			/*timers G1*/
			/*actions G1*/
			if (CB_edge_bool(_X_10, _X_10_PREV) < 0) {
				loadingRequest = 0;
				cycleEnd = 0;
			}
			if (CB_edge_bool(_X_11, _X_11_PREV) < 0) {
				clamping = 0;
			}
			if (CB_edge_bool(_X_12, _X_12_PREV) < 0) {
				fastDescent = 0;
				rotation = 0;
			}
			if (CB_edge_bool(_X_13, _X_13_PREV) < 0) {
				slowDescent = 0;
				rotation = 0;
			}
			if (CB_edge_bool(_X_14, _X_14_PREV) < 0) {
				fastAscent = 0;
				rotation = 0;
			}
			if (CB_edge_bool(_X_15, _X_15_PREV) < 0) {
				slowAscent = 0;
			}
			if (CB_edge_bool(_X_16, _X_16_PREV) < 0) {
				releasing = 0;
			}
			if (CB_edge_bool(_X_17, _X_17_PREV) < 0) {
				cycleEnd = 0;
				unloadingRequest = 0;
			}
			if (_X_10) {
				loadingRequest = 1;
				cycleEnd = 1;
			}
			if (_X_11) {
				clamping = 1;
			}
			if (_X_12) {
				fastDescent = 1;
				rotation = 1;
				cnt = cnt + 1;
			}
			if (_X_13) {
				slowDescent = 1;
				rotation = 1;
				cnt = cnt + 1;
			}
			if (_X_14) {
				fastAscent = 1;
				rotation = 1;
				cnt = cnt + 1;
			}
			if (_X_15) {
				slowAscent = 1;
				cnt = cnt + 1;
			}
			if (_X_16) {
				releasing = 1;
			}
			if (_X_17) {
				cycleEnd = 1;
				unloadingRequest = 1;
			}
			/*post-SFC*/
			if ((((_X_10 || (CB_edge_bool(_X_12, _X_12_PREV) > 0)) || (CB_edge_bool(_X_13, _X_13_PREV) > 0)) || (CB_edge_bool(_X_14, _X_14_PREV) > 0)) || (CB_edge_bool(_X_15, _X_15_PREV) > 0)) {
				cov_control_struct(__comp_name, self_num, INPOSTSFC, 1, IFTHEN);
				cnt = 0;
			}
			else {
				cov_control_struct(__comp_name, self_num, INPOSTSFC, 1, IFELSE);
			}
			faultyState = !noFaultCond;
			_X_13_PREV = _X_13;
			acknowledgePB_PREV = acknowledgePB;
			_X_16_PREV = _X_16;
			unitProd_PREV = unitProd;
			_X_10_PREV = _X_10;
			_X_11_PREV = _X_11;
			_X_14_PREV = _X_14;
			_X_12_PREV = _X_12;
			_X_15_PREV = _X_15;
			_X_17_PREV = _X_17;
		}

		CB_post_bool(run_rotation);
		CB_post_bool(run_cycleEnd);
		CB_post_int(run_movementFault);
		CB_post_bool(run_loadingRequest);
		CB_post_bool(run_unloadingRequest);
		CB_post_bool(run_faultyState);
		CB_post_bool(run_slowAscent);
		CB_post_bool(run_fastAscent);
		CB_post_bool(run_slowDescent);
		CB_post_bool(run_fastDescent);
		CB_post_bool(run_releasing);
		CB_post_bool(run_clamping);

		/******************** Post-conditions execution *********************/

		/*no Post-conditions*/
	}

	/*************************** self update ****************************/

	self.Bool += 20;
	self.Int += 7;

	return 0;
}

