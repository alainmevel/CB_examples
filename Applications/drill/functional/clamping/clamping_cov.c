/*2023-10-03T11:13:44-01:00*/

/********************************************************************
 * clamping_cov.c
 * 
 * generated by: plcgen 3.1.391
 ********************************************************************/

#include "cb_comp.h"
#include "cb_covs.h"
#include "iec_1131.h"

#include "clamping.h"


/**************************** Variables *****************************/

CB_Index clamping__num = 0;
CB_Mem_Bool *clamping_acknowledgePB;
CB_Mem_Bool *clamping_releasing;
CB_Mem_Bool *clamping_clamping;
CB_Mem_Bool *clamping_rightUnlocked;
CB_Mem_Bool *clamping_rightLocked;
CB_Mem_Bool *clamping_leftUnlocked;
CB_Mem_Bool *clamping_leftLocked;
CB_Mem_Bool *clamping_rightFault;
CB_Mem_Bool *clamping_leftFault;
CB_Mem_Bool *clamping_clampingOK;
CB_Mem_Bool *clamping_releasingOK;
CB_Mem_Int *clamping_clampingFault;
CB_Mem_Bool *clamping_rightLocking;
CB_Mem_Bool *clamping_leftLocking;
CB_Mem_Int *clamping_clampingDuration;
CB_Mem_Int *clamping_releasingDuration;
CB_Mem_Bool *clamping__X_10;
CB_Mem_Bool *clamping__X_11;
CB_Mem_Bool *clamping__X_12;
CB_Mem_Bool *clamping__X_13;
CB_Mem_Bool *clamping__X_14;
CB_Mem_Bool *clamping_acknowledgePB_PREV;
CB_Mem_Int *clamping_acknowledgePB_EDGE;
CB_Mem_Bool *clamping__X_10_PREV;
CB_Mem_Bool *clamping__X_12_PREV;

/**************************** Variables *****************************/

#define acknowledgePB (clamping_acknowledgePB->CB_current_value)
#define releasing (clamping_releasing->CB_current_value)
#define clamping (clamping_clamping->CB_current_value)
#define rightUnlocked (clamping_rightUnlocked->CB_current_value)
#define rightLocked (clamping_rightLocked->CB_current_value)
#define leftUnlocked (clamping_leftUnlocked->CB_current_value)
#define leftLocked (clamping_leftLocked->CB_current_value)
#define rightFault (clamping_rightFault->CB_current_value)
#define leftFault (clamping_leftFault->CB_current_value)
#define clampingOK (clamping_clampingOK->CB_current_value)
#define releasingOK (clamping_releasingOK->CB_current_value)
#define clampingFault (clamping_clampingFault->CB_current_value)
#define rightLocking (clamping_rightLocking->CB_current_value)
#define leftLocking (clamping_leftLocking->CB_current_value)
#define clampingDuration (clamping_clampingDuration->CB_current_value)
#define releasingDuration (clamping_releasingDuration->CB_current_value)
#define _X_10 (clamping__X_10->CB_current_value)
#define _X_11 (clamping__X_11->CB_current_value)
#define _X_12 (clamping__X_12->CB_current_value)
#define _X_13 (clamping__X_13->CB_current_value)
#define _X_14 (clamping__X_14->CB_current_value)
#define acknowledgePB_PREV (clamping_acknowledgePB_PREV->CB_current_value)
#define acknowledgePB_EDGE (clamping_acknowledgePB_EDGE->CB_current_value)
#define _X_10_PREV (clamping__X_10_PREV->CB_current_value)
#define _X_12_PREV (clamping__X_12_PREV->CB_current_value)


/************************ Components offsets ************************/


/********************* Initialization function **********************/

int _drill__clamping_init(void)
{
	(self.Int+0)->CB_current_value = 110; /*clampingDuration*/
	(self.Int+1)->CB_current_value = 110; /*releasingDuration*/
	(self.Bool+0)->CB_current_value = 1; /*_X_10*/
	(self.Bool+6)->CB_current_value = 1; /*_X_10_PREV*/
	self.Bool+=8;
	self.Int+=3;


	return 0;
}


/************************ Behavior function *************************/

int drill__clamping(void)
{
	static char *__comp_name = "drill.clamping";
	if (exec_term_node(self_num)) {

		/*********************** Internals variables ************************/

		clamping_clampingDuration = self.Int+0;
		clamping_releasingDuration = self.Int+1;
		clamping__X_10 = self.Bool+0;
		clamping__X_11 = self.Bool+1;
		clamping__X_12 = self.Bool+2;
		clamping__X_13 = self.Bool+3;
		clamping__X_14 = self.Bool+4;
		clamping_acknowledgePB_PREV = self.Bool+5;
		clamping_acknowledgePB_EDGE = self.Int+2;
		clamping__X_10_PREV = self.Bool+6;
		clamping__X_12_PREV = self.Bool+7;

		/********************* Pre-conditions execution *********************/

		/*no Pre-conditions*/

		/************************ Behavior execution ************************/

		{
			unsigned char _Y_9;
			unsigned char _Y_8;
			unsigned char _Y_7;
			unsigned char _Y_10;
			unsigned char _Y_6;
			unsigned char _Y_11;
			unsigned char _Y_13;
			unsigned char _Y_14;
			unsigned char _Y_12;
			acknowledgePB_EDGE = CB_edge_bool(acknowledgePB, acknowledgePB_PREV);
			/*pre-SFC*/
			if ((_X_10 || _X_12) && (acknowledgePB_EDGE > 0)) {
				cov_control_struct(__comp_name, self_num, INPRESFC, 1, IFTHEN);
				clampingFault = 0;
			}
			else {
				cov_control_struct(__comp_name, self_num, INPRESFC, 1, IFELSE);
			}
			if (_X_11 && rightFault) {
				cov_control_struct(__comp_name, self_num, INPRESFC, 4, IFTHEN);
				clampingFault = 1;
			}
			else {
				cov_control_struct(__comp_name, self_num, INPRESFC, 4, IFELSE);
			}
			if (_X_11 && leftFault) {
				cov_control_struct(__comp_name, self_num, INPRESFC, 7, IFTHEN);
				clampingFault = 2;
			}
			else {
				cov_control_struct(__comp_name, self_num, INPRESFC, 7, IFELSE);
			}
			if (_X_13 && rightFault) {
				cov_control_struct(__comp_name, self_num, INPRESFC, 10, IFTHEN);
				clampingFault = 3;
			}
			else {
				cov_control_struct(__comp_name, self_num, INPRESFC, 10, IFELSE);
			}
			if (_X_13 && leftFault) {
				cov_control_struct(__comp_name, self_num, INPRESFC, 13, IFTHEN);
				clampingFault = 4;
			}
			else {
				cov_control_struct(__comp_name, self_num, INPRESFC, 13, IFELSE);
			}
			/*transitions G1*/
			_Y_9 = _X_10 && ((clamping && !releasing) && (clampingFault == 0));
			_Y_8 = _X_11 && (rightLocked && leftLocked);
			_Y_7 = _X_12 && ((releasing && !clamping) && (clampingFault == 0));
			_Y_10 = _X_13 && (clamping && !releasing);
			_Y_6 = _X_13 && (!_Y_10 && (rightUnlocked && leftUnlocked));
			_Y_11 = _X_11 && (!_Y_8 && (releasing && !clamping));
			_Y_13 = _X_13 && (!_Y_10 && (!_Y_6 && (clampingFault > 0)));
			_Y_14 = _X_14 && (rightUnlocked && leftUnlocked);
			_Y_12 = _X_11 && (!_Y_8 && (!_Y_11 && (clampingFault > 0)));
			/*evolutions G1*/
			if (_Y_9) {
				_X_10 = 0;
			}
			if (_Y_8) {
				_X_11 = 0;
			}
			if (_Y_7) {
				_X_12 = 0;
			}
			if (_Y_10) {
				_X_13 = 0;
			}
			if (_Y_6) {
				_X_13 = 0;
			}
			if (_Y_11) {
				_X_11 = 0;
			}
			if (_Y_13) {
				_X_13 = 0;
			}
			if (_Y_14) {
				_X_14 = 0;
			}
			if (_Y_12) {
				_X_11 = 0;
			}
			if (_Y_9) {
				_X_11 = 1;
			}
			if (_Y_8) {
				_X_12 = 1;
			}
			if (_Y_7) {
				_X_13 = 1;
			}
			if (_Y_10) {
				_X_11 = 1;
			}
			if (_Y_6) {
				_X_10 = 1;
			}
			if (_Y_11) {
				_X_13 = 1;
			}
			if (_Y_13) {
				_X_14 = 1;
			}
			if (_Y_14) {
				_X_10 = 1;
			}
			if (_Y_12) {
				_X_14 = 1;
			}
			/*timers G1*/
			/*actions G1*/
			if (CB_edge_bool(_X_10, _X_10_PREV) < 0) {
				releasingOK = 0;
			}
			if (CB_edge_bool(_X_12, _X_12_PREV) < 0) {
				clampingOK = 0;
			}
			if (_X_10) {
				if (clampingFault == 0) {
					releasingOK = 1;
				}
				else {
					releasingOK = 0;
				}
			}
			if (_X_12) {
				clampingOK = 1;
			}
			/*post-SFC*/
			leftLocking = _X_11 || _X_12;
			rightLocking = _X_11 || _X_12;
			acknowledgePB_PREV = acknowledgePB;
			_X_10_PREV = _X_10;
			_X_12_PREV = _X_12;
		}

		CB_post_bool(clamping_clampingOK);
		CB_post_bool(clamping_releasingOK);
		CB_post_int(clamping_clampingFault);
		CB_post_bool(clamping_rightLocking);
		CB_post_bool(clamping_leftLocking);

		/******************** Post-conditions execution *********************/

		/*no Post-conditions*/
	}

	/*************************** self update ****************************/

	self.Bool += 8;
	self.Int += 3;

	return 0;
}

