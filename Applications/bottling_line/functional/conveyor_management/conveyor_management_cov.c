/*2023-10-03T11:13:41-01:00*/

/********************************************************************
 * conveyor_management_cov.c
 * 
 * generated by: plcgen 3.1.391
 ********************************************************************/

#include "cb_comp.h"
#include "cb_covs.h"
#include "iec_1131.h"

#include "conveyor_management.h"


/**************************** Variables *****************************/

CB_Index conveyor_management__num = 0;
CB_Mem_Bool *conveyor_management_productionRequest;
CB_Mem_Bool *conveyor_management_pulseGenerator;
CB_Mem_Bool *conveyor_management_bottleFilled;
CB_Mem_Bool *conveyor_management_bottlePresent;
CB_Mem_Bool *conveyor_management_load;
CB_Mem_Bool *conveyor_management_evacuate;
CB_Mem_Bool *conveyor_management_convoy;
CB_Mem_Bool *conveyor_management_valve5;
CB_Mem_Int *conveyor_management_encoder;
CB_Mem_Int *conveyor_management_value;
CB_Mem_Int *conveyor_management_increment;
CB_Mem_Bool *conveyor_management__X_10;
CB_Mem_Bool *conveyor_management__X_11;
CB_Mem_Bool *conveyor_management__X_12;
CB_Mem_Bool *conveyor_management__X_13;
CB_Mem_Bool *conveyor_management__X_14;
CB_Mem_Int *conveyor_management__TIMER_12;
CB_Mem_Int *conveyor_management__TIMER_13;
CB_Mem_Bool *conveyor_management__X_12_PREV;
CB_Mem_Bool *conveyor_management__X_13_PREV;
CB_Mem_Bool *conveyor_management__X_11_PREV;
CB_Mem_Bool *conveyor_management__X_14_PREV;
CB_Mem_Bool *conveyor_management_pulseGenerator_PREV;
CB_Mem_Int *conveyor_management_pulseGenerator_EDGE;

/**************************** Variables *****************************/

#define productionRequest (conveyor_management_productionRequest->CB_current_value)
#define pulseGenerator (conveyor_management_pulseGenerator->CB_current_value)
#define bottleFilled (conveyor_management_bottleFilled->CB_current_value)
#define bottlePresent (conveyor_management_bottlePresent->CB_current_value)
#define load (conveyor_management_load->CB_current_value)
#define evacuate (conveyor_management_evacuate->CB_current_value)
#define convoy (conveyor_management_convoy->CB_current_value)
#define valve5 (conveyor_management_valve5->CB_current_value)
#define encoder (*((short *)&(conveyor_management_encoder->CB_current_value) + ALIGN_OFFSET_SHORT))
#define value (*((short *)&(conveyor_management_value->CB_current_value) + ALIGN_OFFSET_SHORT))
#define increment (*((short *)&(conveyor_management_increment->CB_current_value) + ALIGN_OFFSET_SHORT))
#define _X_10 (conveyor_management__X_10->CB_current_value)
#define _X_11 (conveyor_management__X_11->CB_current_value)
#define _X_12 (conveyor_management__X_12->CB_current_value)
#define _X_13 (conveyor_management__X_13->CB_current_value)
#define _X_14 (conveyor_management__X_14->CB_current_value)
#define _TIMER_12 (*((unsigned long *)&(conveyor_management__TIMER_12->CB_current_value)))
#define _TIMER_13 (*((unsigned long *)&(conveyor_management__TIMER_13->CB_current_value)))
#define _X_12_PREV (conveyor_management__X_12_PREV->CB_current_value)
#define _X_13_PREV (conveyor_management__X_13_PREV->CB_current_value)
#define _X_11_PREV (conveyor_management__X_11_PREV->CB_current_value)
#define _X_14_PREV (conveyor_management__X_14_PREV->CB_current_value)
#define pulseGenerator_PREV (conveyor_management_pulseGenerator_PREV->CB_current_value)
#define pulseGenerator_EDGE (conveyor_management_pulseGenerator_EDGE->CB_current_value)


/************************ Components offsets ************************/


/********************* Initialization function **********************/

int _bottling_line__conveyor_management_init(void)
{
	*((short *)&((self.Int+1)->CB_current_value) + ALIGN_OFFSET_SHORT) = 10; /*value*/
	*((short *)&((self.Int+2)->CB_current_value) + ALIGN_OFFSET_SHORT) = 1; /*increment*/
	(self.Bool+0)->CB_current_value = 1; /*_X_10*/
	self.Bool+=10;
	self.Int+=6;


	return 0;
}


/************************ Behavior function *************************/

int bottling_line__conveyor_management(void)
{
	static char *__comp_name = "bottling_line.conveyor_management";
	if (exec_term_node(self_num)) {

		/*********************** Internals variables ************************/

		conveyor_management_encoder = self.Int+0;
		conveyor_management_value = self.Int+1;
		conveyor_management_increment = self.Int+2;
		conveyor_management__X_10 = self.Bool+0;
		conveyor_management__X_11 = self.Bool+1;
		conveyor_management__X_12 = self.Bool+2;
		conveyor_management__X_13 = self.Bool+3;
		conveyor_management__X_14 = self.Bool+4;
		conveyor_management__TIMER_12 = self.Int+3;
		conveyor_management__TIMER_13 = self.Int+4;
		conveyor_management__X_12_PREV = self.Bool+5;
		conveyor_management__X_13_PREV = self.Bool+6;
		conveyor_management__X_11_PREV = self.Bool+7;
		conveyor_management__X_14_PREV = self.Bool+8;
		conveyor_management_pulseGenerator_PREV = self.Bool+9;
		conveyor_management_pulseGenerator_EDGE = self.Int+5;

		/********************* Pre-conditions execution *********************/

		/*no Pre-conditions*/

		/************************ Behavior execution ************************/

		{
			unsigned char _Y_10;
			unsigned char _Y_9;
			unsigned char _Y_8;
			unsigned char _Y_7;
			unsigned char _Y_6;
			unsigned char _Y_11;
			pulseGenerator_EDGE = CB_edge_bool(pulseGenerator, pulseGenerator_PREV);
			/*pre-SFC*/
			/*transitions G1*/
			_Y_10 = _X_10 && (productionRequest && bottlePresent);
			_Y_9 = _X_11 && bottleFilled;
			_Y_8 = _X_12 && (_TIMER_12 >= 2 * 1000000.0 / CLOCK_PERIOD);
			_Y_7 = _X_13 && (_TIMER_13 >= 2 * 1000000.0 / CLOCK_PERIOD);
			_Y_6 = _X_14 && (encoder >= value);
			_Y_11 = _X_10 && (!_Y_10 && (productionRequest && !bottlePresent));
			/*evolutions G1*/
			if (_Y_10) {
				_X_10 = 0;
			}
			if (_Y_9) {
				_X_11 = 0;
			}
			if (_Y_8) {
				_X_12 = 0;
			}
			if (_Y_7) {
				_X_13 = 0;
			}
			if (_Y_6) {
				_X_14 = 0;
			}
			if (_Y_11) {
				_X_10 = 0;
			}
			if (_Y_10) {
				_X_11 = 1;
			}
			if (_Y_9) {
				_X_12 = 1;
			}
			if (_Y_8) {
				_X_13 = 1;
			}
			if (_Y_7) {
				_X_14 = 1;
			}
			if (_Y_6) {
				_X_10 = 1;
			}
			if (_Y_11) {
				_X_12 = 1;
			}
			/*timers G1*/
			if (_X_12) {
				if (CB_edge_bool(_X_12, _X_12_PREV) > 0) {
					_TIMER_12 = 0;
				}
				else {
					if (_TIMER_12 < _MAX_TIMER) {
						_TIMER_12 = _TIMER_12 + 1;
					}
				}
			}
			if (_X_13) {
				if (CB_edge_bool(_X_13, _X_13_PREV) > 0) {
					_TIMER_13 = 0;
				}
				else {
					if (_TIMER_13 < _MAX_TIMER) {
						_TIMER_13 = _TIMER_13 + 1;
					}
				}
			}
			/*actions G1*/
			if (CB_edge_bool(_X_11, _X_11_PREV) < 0) {
				valve5 = 0;
			}
			if (CB_edge_bool(_X_14, _X_14_PREV) < 0) {
				convoy = 0;
			}
			if (_X_10) {
				encoder = 0;
			}
			if (_X_11) {
				valve5 = 1;
			}
			if (_X_12) {
				load = 1;
				evacuate = 1;
			}
			if (_X_13) {
				load = 0;
				evacuate = 0;
			}
			if (_X_14) {
				convoy = 1;
				if (pulseGenerator_EDGE > 0) {
					encoder = encoder + increment;
				}
			}
			/*post-SFC*/
			_X_13_PREV = _X_13;
			_X_11_PREV = _X_11;
			pulseGenerator_PREV = pulseGenerator;
			_X_14_PREV = _X_14;
			_X_12_PREV = _X_12;
		}

		CB_post_bool(conveyor_management_load);
		CB_post_bool(conveyor_management_evacuate);
		CB_post_bool(conveyor_management_convoy);
		CB_post_bool(conveyor_management_valve5);

		/******************** Post-conditions execution *********************/

		/*no Post-conditions*/
	}

	/*************************** self update ****************************/

	self.Bool += 10;
	self.Int += 6;

	return 0;
}

