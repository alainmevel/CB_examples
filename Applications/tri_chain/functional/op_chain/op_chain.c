/*2023-10-03T11:13:59-01:00*/

/********************************************************************
 * op_chain.c
 * 
 * generated by: plcgen 3.1.391
 ********************************************************************/

#include "cb_comp.h"
#include "iec_1131.h"

#include "op_chain.h"
#include "tri_chain/functional/motor1dir_1speed/motor1dir_1speed.h"
#include "tri_chain/functional/button/button.h"
#include "tri_chain/functional/passing_sensor/passing_sensor.h"
#include "tri_chain/functional/conveyor1/conveyor1.h"


/**************************** Variables *****************************/

CB_Index op_chain__num = 0;
CB_Mem_Bool *op_chain_forward;
CB_Mem_Bool *op_chain_localRun;
CB_Mem_Bool *op_chain_start_sensor;
CB_Mem_Bool *op_chain_end_sensor;

/**************************** Variables *****************************/



/************************ Components offsets ************************/

static CB_Offset tri_chain__op_chain_offset_motor1dir;
static CB_Offset tri_chain__op_chain_offset_runButton;
static CB_Offset tri_chain__op_chain_offset_start_sensor;
static CB_Offset tri_chain__op_chain_offset_end_sensor;
static CB_Offset tri_chain__op_chain_offset_chain;
static CB_Offset tri_chain__op_chain_offset__end = {0, 0, 0, 0};


/********************* Initialization function **********************/

int _tri_chain__op_chain_init(void)
{
	CB_Object __start = self;
	self.Bool+=7;
	self.Float+=2;

	/*initialize child motor1dir (tri_chain.motor1dir_1speed):*/
	self_num++;
	tri_chain__op_chain_offset_motor1dir.Bool = self.Bool - __start.Bool;
	tri_chain__op_chain_offset_motor1dir.Int = self.Int - __start.Int;
	tri_chain__op_chain_offset_motor1dir.Float = self.Float - __start.Float;
	tri_chain__op_chain_offset_motor1dir.Char = self.Char - __start.Char;
	motor1dir_1speed_forward = op_chain_forward;
	motor1dir_1speed_cmdSupply = __start.Bool+6; /*op_chain__cn_2*/
	motor1dir_1speed_sensorSupply = __start.Bool+5; /*op_chain__cn_3*/
	motor1dir_1speed_voltage380 = __start.Bool+4; /*op_chain__cn_4*/
	motor1dir_1speed_speedVal = __start.Float+1; /*op_chain__cn_1*/
	motor1dir_1speed_speedPercent = __start.Float+0; /*op_chain__cn_5*/
	motor1dir_1speed_thermal = __start.Bool+3; /*op_chain__cn_6*/
	motor1dir_1speed_forwardFB = __start.Bool+2; /*op_chain__cn_7*/
	_tri_chain__motor1dir_1speed_init();

	/*initialize child runButton (tri_chain.button):*/
	self_num++;
	tri_chain__op_chain_offset_runButton.Bool = self.Bool - __start.Bool;
	tri_chain__op_chain_offset_runButton.Int = self.Int - __start.Int;
	tri_chain__op_chain_offset_runButton.Float = self.Float - __start.Float;
	tri_chain__op_chain_offset_runButton.Char = self.Char - __start.Char;
	button_output = op_chain_localRun;
	_tri_chain__button_init();

	/*initialize child start_sensor (tri_chain.passing_sensor):*/
	self_num++;
	tri_chain__op_chain_offset_start_sensor.Bool = self.Bool - __start.Bool;
	tri_chain__op_chain_offset_start_sensor.Int = self.Int - __start.Int;
	tri_chain__op_chain_offset_start_sensor.Float = self.Float - __start.Float;
	tri_chain__op_chain_offset_start_sensor.Char = self.Char - __start.Char;
	passing_sensor_sensorSupply = __start.Bool+1; /*op_chain__cn_8*/
	passing_sensor_passing = op_chain_start_sensor;
	_tri_chain__passing_sensor_init();

	/*initialize child end_sensor (tri_chain.passing_sensor):*/
	self_num++;
	tri_chain__op_chain_offset_end_sensor.Bool = self.Bool - __start.Bool;
	tri_chain__op_chain_offset_end_sensor.Int = self.Int - __start.Int;
	tri_chain__op_chain_offset_end_sensor.Float = self.Float - __start.Float;
	tri_chain__op_chain_offset_end_sensor.Char = self.Char - __start.Char;
	passing_sensor_sensorSupply = __start.Bool+0; /*op_chain__cn_9*/
	passing_sensor_passing = op_chain_end_sensor;
	_tri_chain__passing_sensor_init();

	/*initialize child chain (tri_chain.conveyor1):*/
	self_num++;
	tri_chain__op_chain_offset_chain.Bool = self.Bool - __start.Bool;
	tri_chain__op_chain_offset_chain.Int = self.Int - __start.Int;
	tri_chain__op_chain_offset_chain.Float = self.Float - __start.Float;
	tri_chain__op_chain_offset_chain.Char = self.Char - __start.Char;
	conveyor1_linearSpeed = __start.Float+1; /*op_chain__cn_1*/
	_tri_chain__conveyor1_init();

	tri_chain__op_chain_offset__end.Bool = self.Bool - __start.Bool;
	tri_chain__op_chain_offset__end.Int = self.Int - __start.Int;
	tri_chain__op_chain_offset__end.Float = self.Float - __start.Float;
	tri_chain__op_chain_offset__end.Char = self.Char - __start.Char;

	return 0;
}


/************************ Behavior function *************************/

int tri_chain__op_chain(void)
{
	CB_Object __start = self;
	int __ret;
	if (exec_mac_node(self_num)) {

		/*********************** Internals variables ************************/

																		
		/********************* Pre-conditions execution *********************/

		/*no Pre-conditions*/

		/************************ Behavior execution ************************/

		{
			self.Bool = __start.Bool + tri_chain__op_chain_offset_motor1dir.Bool;
			self.Int = __start.Int + tri_chain__op_chain_offset_motor1dir.Int;
			self.Float = __start.Float + tri_chain__op_chain_offset_motor1dir.Float;
			self.Char = __start.Char + tri_chain__op_chain_offset_motor1dir.Char;

			/*********************** motor1dir execution ************************/

			self_num++;
			if (motor1dir_1speed__num != self_num) {
				motor1dir_1speed__num = self_num;
				motor1dir_1speed_forward = op_chain_forward;
				motor1dir_1speed_cmdSupply = __start.Bool+6; /*op_chain__cn_2*/
				motor1dir_1speed_sensorSupply = __start.Bool+5; /*op_chain__cn_3*/
				motor1dir_1speed_voltage380 = __start.Bool+4; /*op_chain__cn_4*/
				motor1dir_1speed_speedVal = __start.Float+1; /*op_chain__cn_1*/
				motor1dir_1speed_speedPercent = __start.Float+0; /*op_chain__cn_5*/
				motor1dir_1speed_thermal = __start.Bool+3; /*op_chain__cn_6*/
				motor1dir_1speed_forwardFB = __start.Bool+2; /*op_chain__cn_7*/
			}
			__ret = tri_chain__motor1dir_1speed();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

			/*********************** runButton execution ************************/

			self_num++;
			if (button__num != self_num) {
				button__num = self_num;
				button_output = op_chain_localRun;
			}
			__ret = tri_chain__button();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

			/********************** start_sensor execution **********************/

			self_num++;
			if (passing_sensor__num != self_num) {
				passing_sensor__num = self_num;
				passing_sensor_sensorSupply = __start.Bool+1; /*op_chain__cn_8*/
				passing_sensor_passing = op_chain_start_sensor;
			}
			__ret = tri_chain__passing_sensor();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

			/*********************** end_sensor execution ***********************/

			self_num++;
			if (passing_sensor__num != self_num) {
				passing_sensor__num = self_num;
				passing_sensor_sensorSupply = __start.Bool+0; /*op_chain__cn_9*/
				passing_sensor_passing = op_chain_end_sensor;
			}
			__ret = tri_chain__passing_sensor();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

			/************************* chain execution **************************/

			self_num++;
			if (conveyor1__num != self_num) {
				conveyor1__num = self_num;
				conveyor1_linearSpeed = __start.Float+1; /*op_chain__cn_1*/
			}
			__ret = tri_chain__conveyor1();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

		}


		/******************** Post-conditions execution *********************/

		/*no Post-conditions*/
	}

	/*************************** self update ****************************/

	self.Bool = __start.Bool + tri_chain__op_chain_offset__end.Bool;
	self.Int = __start.Int + tri_chain__op_chain_offset__end.Int;
	self.Float = __start.Float + tri_chain__op_chain_offset__end.Float;
	self.Char = __start.Char + tri_chain__op_chain_offset__end.Char;

	return 0;
}

