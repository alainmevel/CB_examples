/*2023-10-03T11:13:55-01:00*/

/********************************************************************
 * creation_cov.c
 * 
 * generated by: plcgen 3.1.391
 ********************************************************************/

#include "cb_comp.h"
#include "cb_covs.h"
#include "iec_1131.h"

#include "creation.h"

#include "tri_chain/functional/boxtri/boxtri.h"

/**************************** Variables *****************************/

CB_Index creation__num = 0;
CB_Mem_Int *creation_idProd;
CB_Mem_Bool *creation_creationFailed;
CB_Mem_Int *creation_status_act_prod;
CB_Mem_Float *creation_m11;
CB_Mem_Float *creation_m12;
CB_Mem_Float *creation_m13;
CB_Mem_Float *creation_m14;
CB_Mem_Float *creation_m21;
CB_Mem_Float *creation_m22;
CB_Mem_Float *creation_m23;
CB_Mem_Float *creation_m24;
CB_Mem_Float *creation_m31;
CB_Mem_Float *creation_m32;
CB_Mem_Float *creation_m33;
CB_Mem_Float *creation_m34;
CB_Mem_Float *creation_m41;
CB_Mem_Float *creation_m42;
CB_Mem_Float *creation_m43;
CB_Mem_Float *creation_m44;
CB_Mem_Float *creation_px;
CB_Mem_Float *creation_py;
CB_Mem_Float *creation_pz;
CB_Mem_Float *creation_dx;
CB_Mem_Float *creation_dy;
CB_Mem_Float *creation_dz;
CB_Mem_Bool *creation_presenceProduct;
CB_Mem_Bool *creation_arrival_PB;
CB_Mem_Float *creation_time2reach;
CB_Mem_Bool *creation_edge_arrival_PB;
CB_Mem_Bool *creation_first;
CB_Mem_Bool *creation_pulseType;
CB_Mem_Float *creation_pulseDuration;

/**************************** Variables *****************************/

#define idProd (creation_idProd->CB_current_value)
#define creationFailed (creation_creationFailed->CB_current_value)
#define status_act_prod (creation_status_act_prod->CB_current_value)
#define m11 (creation_m11->CB_current_value)
#define m12 (creation_m12->CB_current_value)
#define m13 (creation_m13->CB_current_value)
#define m14 (creation_m14->CB_current_value)
#define m21 (creation_m21->CB_current_value)
#define m22 (creation_m22->CB_current_value)
#define m23 (creation_m23->CB_current_value)
#define m24 (creation_m24->CB_current_value)
#define m31 (creation_m31->CB_current_value)
#define m32 (creation_m32->CB_current_value)
#define m33 (creation_m33->CB_current_value)
#define m34 (creation_m34->CB_current_value)
#define m41 (creation_m41->CB_current_value)
#define m42 (creation_m42->CB_current_value)
#define m43 (creation_m43->CB_current_value)
#define m44 (creation_m44->CB_current_value)
#define px (creation_px->CB_current_value)
#define py (creation_py->CB_current_value)
#define pz (creation_pz->CB_current_value)
#define dx (creation_dx->CB_current_value)
#define dy (creation_dy->CB_current_value)
#define dz (creation_dz->CB_current_value)
#define presenceProduct (creation_presenceProduct->CB_current_value)
#define arrival_PB (creation_arrival_PB->CB_current_value)
#define time2reach (creation_time2reach->CB_current_value)
#define edge_arrival_PB (creation_edge_arrival_PB->CB_current_value)
#define first (creation_first->CB_current_value)
#define pulseType (creation_pulseType->CB_current_value)
#define pulseDuration (creation_pulseDuration->CB_current_value)


/************************ Components offsets ************************/


/********************* Initialization function **********************/

int _tri_chain__creation_init(void)
{
	(self.Float+0)->CB_current_value = 1.0; /*m11*/
	(self.Float+5)->CB_current_value = 1.0; /*m22*/
	(self.Float+10)->CB_current_value = 1.0; /*m33*/
	(self.Float+15)->CB_current_value = 1.0; /*m44*/
	(self.Bool+3)->CB_current_value = 1; /*first*/
	(self.Float+23)->CB_current_value = 10.0; /*pulseDuration*/
	self.Bool+=5;
	self.Int+=1;
	self.Float+=24;


	return 0;
}


/************************ Behavior function *************************/

int tri_chain__creation(void)
{
	static char *__comp_name = "tri_chain.creation";
	if (exec_term_node(self_num)) {

		/*********************** Internals variables ************************/

		creation_status_act_prod = self.Int+0;
		creation_m11 = self.Float+0;
		creation_m12 = self.Float+1;
		creation_m13 = self.Float+2;
		creation_m14 = self.Float+3;
		creation_m21 = self.Float+4;
		creation_m22 = self.Float+5;
		creation_m23 = self.Float+6;
		creation_m24 = self.Float+7;
		creation_m31 = self.Float+8;
		creation_m32 = self.Float+9;
		creation_m33 = self.Float+10;
		creation_m34 = self.Float+11;
		creation_m41 = self.Float+12;
		creation_m42 = self.Float+13;
		creation_m43 = self.Float+14;
		creation_m44 = self.Float+15;
		creation_px = self.Float+16;
		creation_py = self.Float+17;
		creation_pz = self.Float+18;
		creation_dx = self.Float+19;
		creation_dy = self.Float+20;
		creation_dz = self.Float+21;
		creation_presenceProduct = self.Bool+0;
		creation_arrival_PB = self.Bool+1;
		creation_time2reach = self.Float+22;
		creation_edge_arrival_PB = self.Bool+2;
		creation_first = self.Bool+3;
		creation_pulseType = self.Bool+4;
		creation_pulseDuration = self.Float+23;

		/********************* Pre-conditions execution *********************/

		/*no Pre-conditions*/

		/************************ Actor Myself init *************************/

		setMyselfFor(self_num);

		/************************ Behavior execution ************************/

		{
			/* ----------------------------------------------------------------	*/
			/* Type : Model of Operative Behaviour					*/
			/* Category :  Product							*/
			/* Author : Dassault Systemes						*/
			/* Update date : June 2018							*/
			/* ----------------------------------------------------------------	*/
			/* This module simulates the arrival of work pieces in a plant.	*/
			/*	The actor cretaes a product when the user acts on a		*/
			/*	launching push-button					.	*/
			/* -----------------------------------------------------------------	*/
			if(first) {
				edge_arrival_PB = arrival_PB;
				first = 0;
			}

			if pulseType {
				if arrival_PB{
					if(timeNow >= time2reach) arrival_PB=0;
				}else {
					time2reach = timeNow + (pulseDuration * 1000000);
				}
			} else {
				if((edge_arrival_PB < arrival_PB) || (edge_arrival_PB > arrival_PB)){
					time2reach = timeNow + (pulseDuration * 1000000);
				}  else {
					if(timeNow >= time2reach) arrival_PB = ! arrival_PB;
				}
			}

			if ((edge_arrival_PB < arrival_PB) && ! presenceProduct) {
				idProd=prodNew(tri_chain__boxtri,px,py,pz,dx,dy,dz);
				if(idProd < 0) creationFailed = 1;
			}

			presenceProduct=0;

			edge_arrival_PB = arrival_PB;
		}

		CB_post_int(creation_idProd);
		CB_post_bool(creation_creationFailed);

		/******************** Post-conditions execution *********************/

		/*no Post-conditions*/
	}

	/*************************** self update ****************************/

	self.Bool += 5;
	self.Int += 1;
	self.Float += 24;

	return 0;
}

