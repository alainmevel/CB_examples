/*2023-10-03T11:13:48-01:00*/

/********************************************************************
 * controller.c
 * 
 * generated by: plcgen 3.1.391
 ********************************************************************/

#include "cb_comp.h"
#include "iec_1131.h"

#include "controller.h"
#include "tni_clock/functional/time_management/time_management.h"
#include "tni_clock/functional/display_management/display_management.h"


/**************************** Variables *****************************/

CB_Index controller__num = 0;
CB_Mem_Int *controller_pressure;
CB_Mem_Bool *controller_tick;
CB_Mem_Bool *controller_B1;
CB_Mem_Bool *controller_B2;
CB_Mem_Bool *controller_B3;
CB_Mem_Bool *controller_B4;
CB_Mem_Int *controller_displayValue;
CB_Mem_Bool *controller_stepMotorSecond;
CB_Mem_Bool *controller_stepMotorMinute;
CB_Mem_Bool *controller_stepMotorHour;
CB_Mem_Bool *controller_switchOnLight;

/**************************** Variables *****************************/



/************************ Components offsets ************************/

static CB_Offset tni_clock__controller_offset_timeManagement;
static CB_Offset tni_clock__controller_offset_displayManagement;
static CB_Offset tni_clock__controller_offset__end = {0, 0, 0, 0};


/********************* Initialization function **********************/

int _tni_clock__controller_init(void)
{
	CB_Object __start = self;
	self.Int+=3;

	/*initialize child timeManagement (tni_clock.time_management):*/
	self_num++;
	tni_clock__controller_offset_timeManagement.Bool = self.Bool - __start.Bool;
	tni_clock__controller_offset_timeManagement.Int = self.Int - __start.Int;
	tni_clock__controller_offset_timeManagement.Float = self.Float - __start.Float;
	tni_clock__controller_offset_timeManagement.Char = self.Char - __start.Char;
	time_management_tick = controller_tick;
	time_management_B1 = controller_B1;
	time_management_B2 = controller_B2;
	time_management_B3 = controller_B3;
	time_management_B4 = controller_B4;
	time_management_stepMotorSecond = controller_stepMotorSecond;
	time_management_stepMotorMinute = controller_stepMotorMinute;
	time_management_stepMotorHour = controller_stepMotorHour;
	time_management_hh = __start.Int+0; /*controller__cn_3*/
	time_management_mn = __start.Int+1; /*controller__cn_2*/
	time_management_sec = __start.Int+2; /*controller__cn_1*/
	_tni_clock__time_management_init();

	/*initialize child displayManagement (tni_clock.display_management):*/
	self_num++;
	tni_clock__controller_offset_displayManagement.Bool = self.Bool - __start.Bool;
	tni_clock__controller_offset_displayManagement.Int = self.Int - __start.Int;
	tni_clock__controller_offset_displayManagement.Float = self.Float - __start.Float;
	tni_clock__controller_offset_displayManagement.Char = self.Char - __start.Char;
	display_management_hh = __start.Int+0; /*controller__cn_3*/
	display_management_mn = __start.Int+1; /*controller__cn_2*/
	display_management_sec = __start.Int+2; /*controller__cn_1*/
	display_management_tick = controller_tick;
	display_management_pressure = controller_pressure;
	display_management_B1 = controller_B1;
	display_management_B2 = controller_B2;
	display_management_B3 = controller_B3;
	display_management_B4 = controller_B4;
	display_management_displayValue = controller_displayValue;
	display_management_switchOnLight = controller_switchOnLight;
	_tni_clock__display_management_init();

	tni_clock__controller_offset__end.Bool = self.Bool - __start.Bool;
	tni_clock__controller_offset__end.Int = self.Int - __start.Int;
	tni_clock__controller_offset__end.Float = self.Float - __start.Float;
	tni_clock__controller_offset__end.Char = self.Char - __start.Char;

	return 0;
}


/************************ Behavior function *************************/

int tni_clock__controller(void)
{
	CB_Object __start = self;
	int __ret;
	if (exec_mac_node(self_num)) {

		/*********************** Internals variables ************************/

						
		/********************* Pre-conditions execution *********************/

		/*no Pre-conditions*/

		/************************ Behavior execution ************************/

		{
			self.Bool = __start.Bool + tni_clock__controller_offset_timeManagement.Bool;
			self.Int = __start.Int + tni_clock__controller_offset_timeManagement.Int;
			self.Float = __start.Float + tni_clock__controller_offset_timeManagement.Float;
			self.Char = __start.Char + tni_clock__controller_offset_timeManagement.Char;

			/********************* timeManagement execution *********************/

			self_num++;
			if (time_management__num != self_num) {
				time_management__num = self_num;
				time_management_tick = controller_tick;
				time_management_B1 = controller_B1;
				time_management_B2 = controller_B2;
				time_management_B3 = controller_B3;
				time_management_B4 = controller_B4;
				time_management_stepMotorSecond = controller_stepMotorSecond;
				time_management_stepMotorMinute = controller_stepMotorMinute;
				time_management_stepMotorHour = controller_stepMotorHour;
				time_management_hh = __start.Int+0; /*controller__cn_3*/
				time_management_mn = __start.Int+1; /*controller__cn_2*/
				time_management_sec = __start.Int+2; /*controller__cn_1*/
			}
			__ret = tni_clock__time_management();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

			/******************* displayManagement execution ********************/

			self_num++;
			if (display_management__num != self_num) {
				display_management__num = self_num;
				display_management_hh = __start.Int+0; /*controller__cn_3*/
				display_management_mn = __start.Int+1; /*controller__cn_2*/
				display_management_sec = __start.Int+2; /*controller__cn_1*/
				display_management_tick = controller_tick;
				display_management_pressure = controller_pressure;
				display_management_B1 = controller_B1;
				display_management_B2 = controller_B2;
				display_management_B3 = controller_B3;
				display_management_B4 = controller_B4;
				display_management_displayValue = controller_displayValue;
				display_management_switchOnLight = controller_switchOnLight;
			}
			__ret = tni_clock__display_management();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

		}


		/******************** Post-conditions execution *********************/

		/*no Post-conditions*/
	}

	/*************************** self update ****************************/

	self.Bool = __start.Bool + tni_clock__controller_offset__end.Bool;
	self.Int = __start.Int + tni_clock__controller_offset__end.Int;
	self.Float = __start.Float + tni_clock__controller_offset__end.Float;
	self.Char = __start.Char + tni_clock__controller_offset__end.Char;

	return 0;
}

