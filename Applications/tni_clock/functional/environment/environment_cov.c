/*2023-10-03T11:13:48-01:00*/

/********************************************************************
 * environment_cov.c
 * 
 * generated by: plcgen 3.1.391
 ********************************************************************/

#include "cb_comp.h"
#include "cb_covs.h"
#include "iec_1131.h"

#include "environment.h"



/**************************** Variables *****************************/

CB_Index environment__num = 0;
CB_Mem_Int *environment_depth;
CB_Mem_Bool *environment_B1;
CB_Mem_Bool *environment_B2;
CB_Mem_Bool *environment_B3;
CB_Mem_Bool *environment_B4;
CB_Mem_Int *environment_pressure;
CB_Mem_Bool *environment_tick;
CB_Mem_Float *environment_hydrostaticPressure;
CB_Mem_Float *environment_absolutePressure;

/**************************** Variables *****************************/

#define depth (*((short *)&(environment_depth->CB_current_value) + ALIGN_OFFSET_SHORT))
#define B1 (environment_B1->CB_current_value)
#define B2 (environment_B2->CB_current_value)
#define B3 (environment_B3->CB_current_value)
#define B4 (environment_B4->CB_current_value)
#define pressure (*((short *)&(environment_pressure->CB_current_value) + ALIGN_OFFSET_SHORT))
#define tick (environment_tick->CB_current_value)
#define hydrostaticPressure (environment_hydrostaticPressure->CB_current_value)
#define absolutePressure (environment_absolutePressure->CB_current_value)


/************************ Components offsets ************************/


/********************* Initialization function **********************/

int _tni_clock__environment_init(void)
{
	self.Float+=2;


	return 0;
}


/************************ Behavior function *************************/

int tni_clock__environment(void)
{
	static char *__comp_name = "tni_clock.environment";
	if (exec_term_node(self_num)) {

		/*********************** Internals variables ************************/

		environment_hydrostaticPressure = self.Float+0;
		environment_absolutePressure = self.Float+1;

		/********************* Pre-conditions execution *********************/

		/*no Pre-conditions*/

		/************************ Behavior execution ************************/

		{
			/*********************** Pressure calculation *********************************/
			/* Absolute pressure :                                                          */
			/*   10 m = 2bar (1bar atm pressure and 1 bar due to water pressure)     */
			/*   + 1bar every 10m                                                       */
			/*                                                                             */
			/* hydrostatic pressure : 1 bar every 10 m                                */
			/*                                                                             */
			/* 1 bar = 0.987 atm                                                           */
			/*******************************************************************************/
			hydrostaticPressure = (abs(depth) / 10.0) * 1024.0;
			absolutePressure = hydrostaticPressure + 1024.0;

			pressure = absolutePressure;



			/************** Quartz management *************/
			tick = ! tick;
		}

		CB_post_int(environment_pressure);
		CB_post_bool(environment_tick);

		/******************** Post-conditions execution *********************/

		/*no Post-conditions*/
	}

	/*************************** self update ****************************/

	self.Float += 2;

	return 0;
}

