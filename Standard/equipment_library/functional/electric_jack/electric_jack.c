/*2023-10-03T11:13:07-01:00*/

/********************************************************************
 * electric_jack.c
 * 
 * generated by: plcgen 3.1.391
 ********************************************************************/

#include "cb_comp.h"
#include "iec_1131.h"

#include "electric_jack.h"



/**************************** Variables *****************************/

CB_Index electric_jack__num = 0;
CB_Mem_Bool *electric_jack_voltage380;
CB_Mem_Bool *electric_jack_cmdSupply;
CB_Mem_Bool *electric_jack_sensorSupply;
CB_Mem_Bool *electric_jack_valveWork;
CB_Mem_Bool *electric_jack_valveRest;
CB_Mem_Bool *electric_jack_outletSensor;
CB_Mem_Bool *electric_jack_inletSensor;
CB_Mem_Bool *electric_jack_valveOpen;
CB_Mem_Bool *electric_jack_valveClosed;
CB_Mem_Bool *electric_jack_thermal;
CB_Mem_Float *electric_jack_rodPosition;
CB_Mem_Float *electric_jack_rodPercent;
CB_Mem_Float *electric_jack_incrementValue;
CB_Mem_Bool *electric_jack_closeState;
CB_Mem_Bool *electric_jack_openState;
CB_Mem_Float *electric_jack_increment;
CB_Mem_Bool *electric_jack_memoClose;
CB_Mem_Bool *electric_jack_memoOpen;
CB_Mem_Bool *electric_jack_inletSensorLogic;
CB_Mem_Bool *electric_jack_outletSensorLogic;
CB_Mem_Bool *electric_jack_openLogic;
CB_Mem_Bool *electric_jack_closeLogic;
CB_Mem_Bool *electric_jack_thermalLogic;
CB_Mem_Float *electric_jack_rodLength;
CB_Mem_Float *electric_jack_time2extend;
CB_Mem_Bool *electric_jack_d_electrical;
CB_Mem_Bool *electric_jack_v_d_electrical;
CB_Mem_Bool *electric_jack_d_valveClose;
CB_Mem_Bool *electric_jack_v_d_valveClose;
CB_Mem_Bool *electric_jack_d_valveOpen;
CB_Mem_Bool *electric_jack_v_d_valveOpen;
CB_Mem_Bool *electric_jack_d_outletSensor;
CB_Mem_Bool *electric_jack_v_d_outletSensor;
CB_Mem_Bool *electric_jack_d_inletSensor;
CB_Mem_Bool *electric_jack_v_d_inletSensor;
CB_Mem_Bool *electric_jack_d_locking;
CB_Mem_Float *electric_jack_v_d_locking;

/**************************** Variables *****************************/

#define voltage380 (electric_jack_voltage380->CB_current_value)
#define cmdSupply (electric_jack_cmdSupply->CB_current_value)
#define sensorSupply (electric_jack_sensorSupply->CB_current_value)
#define valveWork (electric_jack_valveWork->CB_current_value)
#define valveRest (electric_jack_valveRest->CB_current_value)
#define outletSensor (electric_jack_outletSensor->CB_current_value)
#define inletSensor (electric_jack_inletSensor->CB_current_value)
#define valveOpen (electric_jack_valveOpen->CB_current_value)
#define valveClosed (electric_jack_valveClosed->CB_current_value)
#define thermal (electric_jack_thermal->CB_current_value)
#define rodPosition (electric_jack_rodPosition->CB_current_value)
#define rodPercent (electric_jack_rodPercent->CB_current_value)
#define incrementValue (electric_jack_incrementValue->CB_current_value)
#define closeState (electric_jack_closeState->CB_current_value)
#define openState (electric_jack_openState->CB_current_value)
#define increment (electric_jack_increment->CB_current_value)
#define memoClose (electric_jack_memoClose->CB_current_value)
#define memoOpen (electric_jack_memoOpen->CB_current_value)
#define inletSensorLogic (electric_jack_inletSensorLogic->CB_current_value)
#define outletSensorLogic (electric_jack_outletSensorLogic->CB_current_value)
#define openLogic (electric_jack_openLogic->CB_current_value)
#define closeLogic (electric_jack_closeLogic->CB_current_value)
#define thermalLogic (electric_jack_thermalLogic->CB_current_value)
#define rodLength (electric_jack_rodLength->CB_current_value)
#define time2extend (electric_jack_time2extend->CB_current_value)
#define d_electrical (electric_jack_d_electrical->CB_current_value)
#define v_d_electrical (electric_jack_v_d_electrical->CB_current_value)
#define d_valveClose (electric_jack_d_valveClose->CB_current_value)
#define v_d_valveClose (electric_jack_v_d_valveClose->CB_current_value)
#define d_valveOpen (electric_jack_d_valveOpen->CB_current_value)
#define v_d_valveOpen (electric_jack_v_d_valveOpen->CB_current_value)
#define d_outletSensor (electric_jack_d_outletSensor->CB_current_value)
#define v_d_outletSensor (electric_jack_v_d_outletSensor->CB_current_value)
#define d_inletSensor (electric_jack_d_inletSensor->CB_current_value)
#define v_d_inletSensor (electric_jack_v_d_inletSensor->CB_current_value)
#define d_locking (electric_jack_d_locking->CB_current_value)
#define v_d_locking (electric_jack_v_d_locking->CB_current_value)


/************************ Components offsets ************************/


/********************* Initialization function **********************/

int _equipment_library__electric_jack_init(void)
{
	(electric_jack_voltage380)->CB_current_value = 1; /*voltage380*/
	(electric_jack_cmdSupply)->CB_current_value = 1; /*cmdSupply*/
	(electric_jack_sensorSupply)->CB_current_value = 1; /*sensorSupply*/
	(self.Bool+4)->CB_current_value = 1; /*inletSensorLogic*/
	(self.Bool+5)->CB_current_value = 1; /*outletSensorLogic*/
	(self.Bool+6)->CB_current_value = 1; /*openLogic*/
	(self.Bool+7)->CB_current_value = 1; /*closeLogic*/
	(self.Float+1)->CB_current_value = 1000.0; /*rodLength*/
	(self.Float+2)->CB_current_value = 2.0; /*time2extend*/
	(self.Bool+10)->CB_current_value = 1; /*v_d_electrical*/
	self.Bool+=20;
	self.Float+=4;


	return 0;
}


/************************ Behavior function *************************/

int equipment_library__electric_jack(void)
{
	if (exec_term_node(self_num)) {

		/*********************** Internals variables ************************/

		electric_jack_closeState = self.Bool+0;
		electric_jack_openState = self.Bool+1;
		electric_jack_increment = self.Float+0;
		electric_jack_memoClose = self.Bool+2;
		electric_jack_memoOpen = self.Bool+3;
		electric_jack_inletSensorLogic = self.Bool+4;
		electric_jack_outletSensorLogic = self.Bool+5;
		electric_jack_openLogic = self.Bool+6;
		electric_jack_closeLogic = self.Bool+7;
		electric_jack_thermalLogic = self.Bool+8;
		electric_jack_rodLength = self.Float+1;
		electric_jack_time2extend = self.Float+2;
		electric_jack_d_electrical = self.Bool+9;
		electric_jack_v_d_electrical = self.Bool+10;
		electric_jack_d_valveClose = self.Bool+11;
		electric_jack_v_d_valveClose = self.Bool+12;
		electric_jack_d_valveOpen = self.Bool+13;
		electric_jack_v_d_valveOpen = self.Bool+14;
		electric_jack_d_outletSensor = self.Bool+15;
		electric_jack_v_d_outletSensor = self.Bool+16;
		electric_jack_d_inletSensor = self.Bool+17;
		electric_jack_v_d_inletSensor = self.Bool+18;
		electric_jack_d_locking = self.Bool+19;
		electric_jack_v_d_locking = self.Float+3;

		/********************* Pre-conditions execution *********************/

		/*no Pre-conditions*/

		/************************ Behavior execution ************************/

		{
			/* ----------------------------------------------------------------	*/
			/* Type : Model of Operative Behaviour					*/
			/* Category :  Associations - Jacks					*/
			/* Author : Dassault Systemes						*/
			/* Update date : June 2018							*/
			/* ----------------------------------------------------------------	*/
			/* This module simulates an electric jack and its electrical 		*/
			/* logic control.								*/
			/* ----------------------------------------------------------------	*/

			/* ----------------------------------------------------------------	*/
			/* Management of orders from Control Part					*/
			/*	if there is no power supply for command the solenoid 		*/
			/*     control valve doesn't understand the control order.		*/
			/* ----------------------------------------------------------------	*/
			if (valveWork && !memoClose && cmdSupply) memoOpen = 1;
			if (!valveWork || !cmdSupply) memoOpen = 0;
			if (!memoOpen && valveRest && cmdSupply) memoClose = 1;
			if (!valveRest || !cmdSupply) memoClose = 0;

			/* ----------------------------------------------------------------	*/
			/* Calculation of the on-state of contactors				*/
			/* ----------------------------------------------------------------	*/
			openState = memoOpen & voltage380 & ! d_electrical;
			closeState = memoClose & voltage380 & ! d_electrical;

			/* ----------------------------------------------------------------	*/
			/* Management of the rod evolution						*/
			/* the rod stays in its current position if there is no pressure 	*/
			/* in the two chambers. 							*/
			/* ----------------------------------------------------------------	*/
			incrementValue = 0;
			if (! d_locking)  {
				if (time2extend > 0.0)
					increment = (rodLength/time2extend)*(CLOCK_PERIOD/1000000);
				if (openState && ! closeState ) {
					if ( rodPosition < rodLength ) {
						(rodPosition) += increment;
						incrementValue = increment;
					}
					if ( rodPosition > rodLength ) {
						incrementValue -= rodPosition - rodLength;
						rodPosition = rodLength;
					}
				}
				if (closeState && ! openState ) {
					if ( rodPosition > 0 ) {
						(rodPosition) -= increment;
						incrementValue = increment * -1.0;
					}
					if ( rodPosition < 0.0 ) {
						incrementValue -= rodPosition;
						rodPosition = 0.0;
					}
				}
			}

			/* ----------------------------------------------------------------	*/
			/* Calculation of the rod position in percentage			*/
			/* ----------------------------------------------------------------	*/
			if (rodLength != 0.0)
				rodPercent = ((rodPosition/rodLength)*100);

			/* ----------------------------------------------------------------	*/
			/* Management of the thermal sensor					*/
			/* ----------------------------------------------------------------	*/
			if (d_electrical) thermal = v_d_electrical;
			else
				thermal = ! thermalLogic && sensorSupply;

			/* ----------------------------------------------------------------	*/
			/* Management of the contactors feed-backs				*/
			/* ----------------------------------------------------------------	*/
			if (d_valveOpen) valveOpen = v_d_valveOpen;
			else
				valveOpen = (memoOpen ^ ! openLogic) && sensorSupply;

			if (d_valveClose) valveClosed = v_d_valveClose;
			else
				valveClosed = (memoClose ^ ! closeLogic) && sensorSupply;

			/* ----------------------------------------------------------------	*/
			/* Management of the sensors state						*/
			/* ----------------------------------------------------------------	*/
			if (d_outletSensor) outletSensor = v_d_outletSensor;
			else
				outletSensor = ((rodPosition >= rodLength) ^ ! outletSensorLogic) && sensorSupply;

			if (d_inletSensor) inletSensor = v_d_inletSensor;
			else
				inletSensor = ((rodPosition <= 0) ^ ! inletSensorLogic) && sensorSupply;




		}

		CB_post_bool(electric_jack_outletSensor);
		CB_post_bool(electric_jack_inletSensor);
		CB_post_bool(electric_jack_valveOpen);
		CB_post_bool(electric_jack_valveClosed);
		CB_post_bool(electric_jack_thermal);
		CB_post_float(electric_jack_rodPosition);
		CB_post_float(electric_jack_rodPercent);
		CB_post_float(electric_jack_incrementValue);

		/******************** Post-conditions execution *********************/

		/*no Post-conditions*/
	}

	/*************************** self update ****************************/

	self.Bool += 20;
	self.Float += 4;

	return 0;
}

