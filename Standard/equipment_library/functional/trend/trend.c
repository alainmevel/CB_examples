/*2023-10-03T11:13:25-01:00*/

/********************************************************************
 * trend.c
 * 
 * generated by: plcgen 3.1.391
 ********************************************************************/

#include "cb_comp.h"
#include "iec_1131.h"

#include "trend.h"



/**************************** Variables *****************************/

CB_Index trend__num = 0;
CB_Mem_Float *trend_gradient;
CB_Mem_Float *trend_interceptPoint;
CB_Mem_Float *trend_A;
CB_Mem_Float *trend_B;
CB_Mem_Float *trend_time;
CB_Mem_Float *trend_realOutput;
CB_Mem_Float *trend_theoricalOutput;
CB_Mem_Float *trend_memoSlope;
CB_Mem_Float *trend_memoInc;
CB_Mem_Bool *trend_d_resetParameters;
CB_Mem_Bool *trend_v_d_resetParameters;
CB_Mem_Bool *trend_d_intermediatePresetting;
CB_Mem_Float *trend_v_d_intermediatePresetting;

/**************************** Variables *****************************/

#define gradient (trend_gradient->CB_current_value)
#define interceptPoint (trend_interceptPoint->CB_current_value)
#define A (trend_A->CB_current_value)
#define B (trend_B->CB_current_value)
#define time (trend_time->CB_current_value)
#define realOutput (trend_realOutput->CB_current_value)
#define theoricalOutput (trend_theoricalOutput->CB_current_value)
#define memoSlope (trend_memoSlope->CB_current_value)
#define memoInc (trend_memoInc->CB_current_value)
#define d_resetParameters (trend_d_resetParameters->CB_current_value)
#define v_d_resetParameters (trend_v_d_resetParameters->CB_current_value)
#define d_intermediatePresetting (trend_d_intermediatePresetting->CB_current_value)
#define v_d_intermediatePresetting (trend_v_d_intermediatePresetting->CB_current_value)


/************************ Components offsets ************************/


/********************* Initialization function **********************/

int _equipment_library__trend_init(void)
{
	self.Bool+=3;
	self.Float+=3;


	return 0;
}


/************************ Behavior function *************************/

int equipment_library__trend(void)
{
	if (exec_term_node(self_num)) {

		/*********************** Internals variables ************************/

		trend_memoSlope = self.Float+0;
		trend_memoInc = self.Float+1;
		trend_d_resetParameters = self.Bool+0;
		trend_v_d_resetParameters = self.Bool+1;
		trend_d_intermediatePresetting = self.Bool+2;
		trend_v_d_intermediatePresetting = self.Float+2;

		/********************* Pre-conditions execution *********************/

		/*no Pre-conditions*/

		/************************ Behavior execution ************************/

		{
			/* ----------------------------------------------------------------	*/
			/* Type : Model of Operative Behaviour					*/
			/* Category :  Toolbox							*/
			/* Author : Dassault Systemes						*/
			/* Update date : June 2018						*/
			/* ----------------------------------------------------------------	*/
			/* This module simulates the addition of two real numbers.		*/
			/* ----------------------------------------------------------------	*/
			/* This module simulates the evolution of a measure in function of 	*/
			/* the time. The operator can simulate a "ax + b" curve .		*/
			/* Nota :									*/
			/*	- an action on the gradient changes the slope while keeping  	*/
			/*		continuity.							*/
			/*	- an action on intercept point keeps the slope and force 	*/
			/*		only intercept point.					*/
			/*	- the time variable is reinitialized at each gradient		*/
			/*		or intercept point change. 					*/
			/* ----------------------------------------------------------------	*/

			if (d_resetParameters) {
				realOutput=0;
				theoricalOutput=0;
				A=0;
				B=0;
				time=0;
				memoSlope=0;
				memoInc=0;
			}
			else {
				if (gradient != memoSlope) {
					memoSlope = gradient;
					A=gradient;
					B=theoricalOutput;
					time=0;
				}
				if (interceptPoint != memoInc) {
					memoInc=interceptPoint;
					B=interceptPoint;
					time=0;
				}
				time=time+(CLOCK_PERIOD/1000000);
				theoricalOutput=A*time+B;

				if (d_intermediatePresetting) 
					realOutput=v_d_intermediatePresetting;
				else 
					realOutput=theoricalOutput;
			}

		}

		CB_post_float(trend_A);
		CB_post_float(trend_B);
		CB_post_float(trend_time);
		CB_post_float(trend_realOutput);
		CB_post_float(trend_theoricalOutput);

		/******************** Post-conditions execution *********************/

		/*no Post-conditions*/
	}

	/*************************** self update ****************************/

	self.Bool += 3;
	self.Float += 3;

	return 0;
}

