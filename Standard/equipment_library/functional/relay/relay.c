/*2023-10-03T11:13:23-01:00*/

/********************************************************************
 * relay.c
 * 
 * generated by: plcgen 3.1.391
 ********************************************************************/

#include "cb_comp.h"
#include "iec_1131.h"

#include "relay.h"



/**************************** Variables *****************************/

CB_Index relay__num = 0;
CB_Mem_Bool *relay_contactorInterlock;
CB_Mem_Bool *relay_cmdSupply;
CB_Mem_Bool *relay_sensorSupply;
CB_Mem_Bool *relay_energyBefore;
CB_Mem_Bool *relay_interlockFB;
CB_Mem_Bool *relay_energyAfter;
CB_Mem_Bool *relay_memoInterlock;
CB_Mem_Bool *relay_interlockLogic;
CB_Mem_Bool *relay_d_interlock;
CB_Mem_Bool *relay_v_d_interlock;

/**************************** Variables *****************************/

#define contactorInterlock (relay_contactorInterlock->CB_current_value)
#define cmdSupply (relay_cmdSupply->CB_current_value)
#define sensorSupply (relay_sensorSupply->CB_current_value)
#define energyBefore (relay_energyBefore->CB_current_value)
#define interlockFB (relay_interlockFB->CB_current_value)
#define energyAfter (relay_energyAfter->CB_current_value)
#define memoInterlock (relay_memoInterlock->CB_current_value)
#define interlockLogic (relay_interlockLogic->CB_current_value)
#define d_interlock (relay_d_interlock->CB_current_value)
#define v_d_interlock (relay_v_d_interlock->CB_current_value)


/************************ Components offsets ************************/


/********************* Initialization function **********************/

int _equipment_library__relay_init(void)
{
	(relay_cmdSupply)->CB_current_value = 1; /*cmdSupply*/
	(relay_sensorSupply)->CB_current_value = 1; /*sensorSupply*/
	(relay_energyBefore)->CB_current_value = 1; /*energyBefore*/
	(self.Bool+1)->CB_current_value = 1; /*interlockLogic*/
	(self.Bool+3)->CB_current_value = 1; /*v_d_interlock*/
	self.Bool+=4;


	return 0;
}


/************************ Behavior function *************************/

int equipment_library__relay(void)
{
	if (exec_term_node(self_num)) {

		/*********************** Internals variables ************************/

		relay_memoInterlock = self.Bool+0;
		relay_interlockLogic = self.Bool+1;
		relay_d_interlock = self.Bool+2;
		relay_v_d_interlock = self.Bool+3;

		/********************* Pre-conditions execution *********************/

		/*no Pre-conditions*/

		/************************ Behavior execution ************************/

		{
			/* ----------------------------------------------------------------	*/
			/* Type : Model of Operative Behaviour					*/
			/* Category :  Power								*/
			/* Author : Dassault Systemes						*/
			/* Update date : June 2010							*/
			/* ----------------------------------------------------------------	*/
			/* This module simulates a relay or a contactor 			*/
			/* 	with its auxiliary contact.						*/
			/* ----------------------------------------------------------------	*/

			/* ----------------------------------------------------------------	*/
			/* Management of orders from Control Part					*/
			/*	if there is no power supply for command 				*/
			/*         the contactor doesn't understand the control order		*/
			/*     Fault is mechanical fault.						*/
			/* ----------------------------------------------------------------	*/
			if (d_interlock) interlockFB=v_d_interlock;
			else memoInterlock=contactorInterlock && cmdSupply;

			/* ----------------------------------------------------------------	*/
			/* Calculation of the on-state of energy					*/
			/* If there is no energy downstream there is no energy downstream	*/
			/* ----------------------------------------------------------------	*/
			energyAfter=memoInterlock & energyBefore;

			/* ----------------------------------------------------------------	*/
			/* Management of feedback to Control Part					*/
			/*	if there is no power supply for the sensor			*/
			/*         there is no contactor feedback.				*/
			/*     else contactor feedback returns its state combined with	*/
			/*	    wiring logic (its default value is : positive).		*/
			/* ----------------------------------------------------------------	*/
			interlockFB=(memoInterlock ^ !interlockLogic) && sensorSupply;
		}

		CB_post_bool(relay_interlockFB);
		CB_post_bool(relay_energyAfter);

		/******************** Post-conditions execution *********************/

		/*no Post-conditions*/
	}

	/*************************** self update ****************************/

	self.Bool += 4;

	return 0;
}

