/*2023-10-03T11:13:14-01:00*/

/********************************************************************
 * contactor.c
 * 
 * generated by: plcgen 3.1.391
 ********************************************************************/

#include "cb_comp.h"
#include "iec_1131.h"

#include "contactor.h"



/**************************** Variables *****************************/

CB_Index contactor__num = 0;
CB_Mem_Bool *contactor_voltage380;
CB_Mem_Bool *contactor_cmdSupply;
CB_Mem_Bool *contactor_sensorSupply;
CB_Mem_Bool *contactor_forward;
CB_Mem_Bool *contactor_forwardState;
CB_Mem_Bool *contactor_contactorFB;
CB_Mem_Bool *contactor_thermal;
CB_Mem_Bool *contactor_memoForward;
CB_Mem_Bool *contactor_forwardLogic;
CB_Mem_Bool *contactor_thermalLogic;
CB_Mem_Bool *contactor_d_forward;
CB_Mem_Bool *contactor_v_d_forward;
CB_Mem_Bool *contactor_d_electrical;
CB_Mem_Bool *contactor_v_d_electrical;

/**************************** Variables *****************************/

#define voltage380 (contactor_voltage380->CB_current_value)
#define cmdSupply (contactor_cmdSupply->CB_current_value)
#define sensorSupply (contactor_sensorSupply->CB_current_value)
#define forward (contactor_forward->CB_current_value)
#define forwardState (contactor_forwardState->CB_current_value)
#define contactorFB (contactor_contactorFB->CB_current_value)
#define thermal (contactor_thermal->CB_current_value)
#define memoForward (contactor_memoForward->CB_current_value)
#define forwardLogic (contactor_forwardLogic->CB_current_value)
#define thermalLogic (contactor_thermalLogic->CB_current_value)
#define d_forward (contactor_d_forward->CB_current_value)
#define v_d_forward (contactor_v_d_forward->CB_current_value)
#define d_electrical (contactor_d_electrical->CB_current_value)
#define v_d_electrical (contactor_v_d_electrical->CB_current_value)


/************************ Components offsets ************************/


/********************* Initialization function **********************/

int _equipment_library__contactor_init(void)
{
	(contactor_voltage380)->CB_current_value = 1; /*voltage380*/
	(contactor_cmdSupply)->CB_current_value = 1; /*cmdSupply*/
	(contactor_sensorSupply)->CB_current_value = 1; /*sensorSupply*/
	(contactor_thermal)->CB_current_value = 1; /*thermal*/
	(self.Bool+1)->CB_current_value = 1; /*forwardLogic*/
	self.Bool+=7;


	return 0;
}


/************************ Behavior function *************************/

int equipment_library__contactor(void)
{
	if (exec_term_node(self_num)) {

		/*********************** Internals variables ************************/

		contactor_memoForward = self.Bool+0;
		contactor_forwardLogic = self.Bool+1;
		contactor_thermalLogic = self.Bool+2;
		contactor_d_forward = self.Bool+3;
		contactor_v_d_forward = self.Bool+4;
		contactor_d_electrical = self.Bool+5;
		contactor_v_d_electrical = self.Bool+6;

		/********************* Pre-conditions execution *********************/

		/*no Pre-conditions*/

		/************************ Behavior execution ************************/

		{
			/* ----------------------------------------------------------------	*/
			/* Type : Model of Operative Behaviour					*/
			/* Category :  Pre-actuators						*/
			/* Author : Dassault Systemes						*/
			/* Update date : June 2018							*/
			/* ----------------------------------------------------------------	*/
			/* This module simulates the interlocking of a contactor.  		*/
			/* It returns its state and a contactor feed-back.			*/
			/* ----------------------------------------------------------------	*/

			/* ----------------------------------------------------------------	*/
			/* Management of orders from Control Part					*/
			/*	if there is no power supply for command 				*/
			/*         the contactor doesn't understand the control order		*/
			/* ----------------------------------------------------------------	*/
			memoForward=forward & cmdSupply & ! d_electrical;

			/* ----------------------------------------------------------------	*/
			/* Calculation of the on-state of contactor				*/
			/* ----------------------------------------------------------------	*/
			forwardState=memoForward & voltage380;

			/* ----------------------------------------------------------------	*/
			/* Management of the thermal feed-back					*/
			/* ----------------------------------------------------------------	*/
			if (d_electrical) thermal = v_d_electrical;
			else
				thermal = ! thermalLogic & sensorSupply;

			/* ----------------------------------------------------------------	*/
			/* Management of feedback to Control Part					*/
			/*     if a fault is required, the contactor feed-back 		*/
			/*		 takes a preset state.					*/
			/*	if there is no power supply for sensor 				*/
			/*         contactor feed-back returns nothing				*/
			/*     else contactor feed-back returns the contactor state combined	*/
			/*	    with wiring logic.						*/
			/* ----------------------------------------------------------------	*/

			if (d_forward) contactorFB = v_d_forward;
			else
				contactorFB = (memoForward ^ ! forwardLogic) && sensorSupply;


		}

		CB_post_bool(contactor_forwardState);
		CB_post_bool(contactor_contactorFB);
		CB_post_bool(contactor_thermal);

		/******************** Post-conditions execution *********************/

		/*no Post-conditions*/
	}

	/*************************** self update ****************************/

	self.Bool += 7;

	return 0;
}

