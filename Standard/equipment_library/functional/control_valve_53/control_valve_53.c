/*2023-10-03T11:13:12-01:00*/

/********************************************************************
 * control_valve_53.c
 * 
 * generated by: plcgen 3.1.391
 ********************************************************************/

#include "cb_comp.h"
#include "iec_1131.h"

#include "control_valve_53.h"



/**************************** Variables *****************************/

CB_Index control_valve_53__num = 0;
CB_Mem_Bool *control_valve_53_valveWork;
CB_Mem_Bool *control_valve_53_valveRest;
CB_Mem_Bool *control_valve_53_energy;
CB_Mem_Bool *control_valve_53_cmdSupply;
CB_Mem_Bool *control_valve_53_pipeWork;
CB_Mem_Bool *control_valve_53_pipeRest;
CB_Mem_Bool *control_valve_53_workMode;
CB_Mem_Bool *control_valve_53_restMode;
CB_Mem_Int *control_valve_53_slidePosition;
CB_Mem_Bool *control_valve_53_d_work;
CB_Mem_Bool *control_valve_53_v_d_work;
CB_Mem_Bool *control_valve_53_d_rest;
CB_Mem_Bool *control_valve_53_v_d_rest;

/**************************** Variables *****************************/

#define valveWork (control_valve_53_valveWork->CB_current_value)
#define valveRest (control_valve_53_valveRest->CB_current_value)
#define energy (control_valve_53_energy->CB_current_value)
#define cmdSupply (control_valve_53_cmdSupply->CB_current_value)
#define pipeWork (control_valve_53_pipeWork->CB_current_value)
#define pipeRest (control_valve_53_pipeRest->CB_current_value)
#define workMode (control_valve_53_workMode->CB_current_value)
#define restMode (control_valve_53_restMode->CB_current_value)
#define slidePosition (control_valve_53_slidePosition->CB_current_value)
#define d_work (control_valve_53_d_work->CB_current_value)
#define v_d_work (control_valve_53_v_d_work->CB_current_value)
#define d_rest (control_valve_53_d_rest->CB_current_value)
#define v_d_rest (control_valve_53_v_d_rest->CB_current_value)


/************************ Components offsets ************************/


/********************* Initialization function **********************/

int _equipment_library__control_valve_53_init(void)
{
	(control_valve_53_energy)->CB_current_value = 1; /*energy*/
	(control_valve_53_cmdSupply)->CB_current_value = 1; /*cmdSupply*/
	self.Bool+=4;
	self.Int+=1;


	return 0;
}


/************************ Behavior function *************************/

int equipment_library__control_valve_53(void)
{
	if (exec_term_node(self_num)) {

		/*********************** Internals variables ************************/

		control_valve_53_slidePosition = self.Int+0;
		control_valve_53_d_work = self.Bool+0;
		control_valve_53_v_d_work = self.Bool+1;
		control_valve_53_d_rest = self.Bool+2;
		control_valve_53_v_d_rest = self.Bool+3;

		/********************* Pre-conditions execution *********************/

		/*no Pre-conditions*/

		/************************ Behavior execution ************************/

		{
			/* ----------------------------------------------------------------	*/
			/* Type : Model of Operative Behaviour					*/
			/* Category :  Pre-actuators						*/
			/* Author : Dassault Systemes						*/
			/* Update date : June 2018							*/
			/* ----------------------------------------------------------------	*/
			/* This module simulates a five-way, three positions control valve	*/
			/* with a Locked Mid-Point or a Free Mid-Point 				*/
			/* used to drive a bistable jack.						*/
			/* ----------------------------------------------------------------	*/

			/* ----------------------------------------------------------------	*/
			/* Management of orders from Control Part					*/
			/*	if there is no power supply for command the solenoid 		*/
			/*     control valve doesn't understand the control order.		*/
			/* Hypothesis : if the two control valves are excited at the 		*/
			/* same time, slide translates to the middle.				*/
			/* ----------------------------------------------------------------	*/
			if (cmdSupply) 
				if (valveWork & ! valveRest) slidePosition = 1;
				else
					if ( ! valveWork & valveRest) slidePosition=2;
					else slidePosition=0;
			else slidePosition=0;

			if (cmdSupply && valveWork) workMode = 1;
			else workMode = 0;

			if (cmdSupply && valveRest) restMode = 1;
			else restMode=0;
				

			/* ----------------------------------------------------------------	*/
			/* Calculation of the on-state of the energy in the pipes		*/
			/*     if a fault is required on a pipe, the latter 			*/
			/*		 takes a preset state.					*/
			/*     if there is no energy in input, pipes are not 			*/
			/*	   under pressure.							*/
			/* ----------------------------------------------------------------	*/
			if (d_work)
				pipeWork = v_d_work;
			else
				pipeWork = (slidePosition ==1) & energy;

			if (d_rest)
				pipeRest=v_d_rest;
			else
				pipeRest = (slidePosition==2) & energy;




		}

		CB_post_bool(control_valve_53_pipeWork);
		CB_post_bool(control_valve_53_pipeRest);
		CB_post_bool(control_valve_53_workMode);
		CB_post_bool(control_valve_53_restMode);

		/******************** Post-conditions execution *********************/

		/*no Post-conditions*/
	}

	/*************************** self update ****************************/

	self.Bool += 4;
	self.Int += 1;

	return 0;
}

