/*2023-10-03T11:13:24-01:00*/

/********************************************************************
 * fuse.c
 * 
 * generated by: plcgen 3.1.391
 ********************************************************************/

#include "cb_comp.h"
#include "iec_1131.h"

#include "fuse.h"



/**************************** Variables *****************************/

CB_Index fuse__num = 0;
CB_Mem_Bool *fuse_energyBefore;
CB_Mem_Bool *fuse_sensorSupply;
CB_Mem_Bool *fuse_fuseState;
CB_Mem_Bool *fuse_energyAfter;
CB_Mem_Bool *fuse_wiringLogic;
CB_Mem_Bool *fuse_d_electric;
CB_Mem_Bool *fuse_v_d_electric;

/**************************** Variables *****************************/

#define energyBefore (fuse_energyBefore->CB_current_value)
#define sensorSupply (fuse_sensorSupply->CB_current_value)
#define fuseState (fuse_fuseState->CB_current_value)
#define energyAfter (fuse_energyAfter->CB_current_value)
#define wiringLogic (fuse_wiringLogic->CB_current_value)
#define d_electric (fuse_d_electric->CB_current_value)
#define v_d_electric (fuse_v_d_electric->CB_current_value)


/************************ Components offsets ************************/


/********************* Initialization function **********************/

int _equipment_library__fuse_init(void)
{
	(fuse_energyBefore)->CB_current_value = 1; /*energyBefore*/
	(fuse_sensorSupply)->CB_current_value = 1; /*sensorSupply*/
	(self.Bool+0)->CB_current_value = 1; /*wiringLogic*/
	self.Bool+=3;


	return 0;
}


/************************ Behavior function *************************/

int equipment_library__fuse(void)
{
	if (exec_term_node(self_num)) {

		/*********************** Internals variables ************************/

		fuse_wiringLogic = self.Bool+0;
		fuse_d_electric = self.Bool+1;
		fuse_v_d_electric = self.Bool+2;

		/********************* Pre-conditions execution *********************/

		/*no Pre-conditions*/

		/************************ Behavior execution ************************/

		{
			/* ----------------------------------------------------------------	*/
			/* Type : Model of Operative Behaviour					*/
			/* Category :  Power								*/
			/* Author : Dassault Systemes						*/
			/* Update date : June 2018							*/
			/* ----------------------------------------------------------------	*/
			/* This module simulates the trip of a fuse.  				*/
			/* This results in a power outage.						*/
			/* It returns its state.							*/
			/* ----------------------------------------------------------------	*/

			/* ----------------------------------------------------------------	*/
			/* Management of feedback to Control Part					*/
			/*     if a fault is required, the fuse takes a preset state. 	*/
			/*	if there is no power supply for sensors 				*/
			/*         fuseState variable returns nothing				*/
			/*     else fuseState variable returns fuse state combined with	*/
			/*	    wiring logic (its default value is : positive).		*/
			/* ----------------------------------------------------------------	*/
			if (d_electric) fuseState = v_d_electric;
			else
				if (sensorSupply) fuseState = sensorSupply ^ !wiringLogic;
				else fuseState = 0;

			/* ----------------------------------------------------------------	*/
			/* Management of the energy flow						*/
			/*     Energy passes through the fuse if there is no electric fault.	*/
			/* ----------------------------------------------------------------	*/
			energyAfter = energyBefore & ! d_electric;


		}

		CB_post_bool(fuse_fuseState);
		CB_post_bool(fuse_energyAfter);

		/******************** Post-conditions execution *********************/

		/*no Post-conditions*/
	}

	/*************************** self update ****************************/

	self.Bool += 3;

	return 0;
}

