/*2023-10-03T11:13:36-01:00*/

/********************************************************************
 * cmd_on_off_pump.c
 * 
 * generated by: plcgen 3.1.391
 ********************************************************************/

#include "cb_comp.h"
#include "iec_1131.h"


/********************************************************************
 *                  Inner 'actuator' declarations                   *
 ********************************************************************/


/********************** Variable declarations ***********************/

static CB_Index actuator__num;
extern CB_Mem_Bool *_i_cmd_on_off_pump__actuator_autoMode;
extern CB_Mem_Bool *_i_cmd_on_off_pump__actuator_manualMode;
extern CB_Mem_Bool *_i_cmd_on_off_pump__actuator_autoCmd;
extern CB_Mem_Bool *_i_cmd_on_off_pump__actuator_onPB;
extern CB_Mem_Bool *_i_cmd_on_off_pump__actuator_offPB;
extern CB_Mem_Bool *_i_cmd_on_off_pump__actuator_generalFault;
extern CB_Mem_Bool *_i_cmd_on_off_pump__actuator_cmd;

/********************** Function declarations ***********************/

static int _cmd_equipment_library__actuator_init(void);
static int cmd_equipment_library__actuator(void);

/********************************************************************
 *                   Inner 'faults' declarations                    *
 ********************************************************************/


/********************** Variable declarations ***********************/

static CB_Index faults__num;
extern CB_Mem_Bool *_i_cmd_on_off_pump__faults_cmd;
extern CB_Mem_Bool *_i_cmd_on_off_pump__faults_thermalFB;
extern CB_Mem_Bool *_i_cmd_on_off_pump__faults_onFB;
extern CB_Mem_Bool *_i_cmd_on_off_pump__faults_acknowledgePB;
extern CB_Mem_Bool *_i_cmd_on_off_pump__faults_generalFault;
extern CB_Mem_Bool *_i_cmd_on_off_pump__faults_thermalFault;
extern CB_Mem_Bool *_i_cmd_on_off_pump__faults_onFBFault;

/********************** Function declarations ***********************/

static int _cmd_equipment_library__faults_init(void);
static int cmd_equipment_library__faults(void);

/********************************************************************
 *                 Inner 'actuator' implementation                  *
 ********************************************************************/



/**************************** Variables *****************************/

static CB_Index actuator__num = 0;
CB_Mem_Bool *_i_cmd_on_off_pump__actuator_autoMode;
CB_Mem_Bool *_i_cmd_on_off_pump__actuator_manualMode;
CB_Mem_Bool *_i_cmd_on_off_pump__actuator_autoCmd;
CB_Mem_Bool *_i_cmd_on_off_pump__actuator_onPB;
CB_Mem_Bool *_i_cmd_on_off_pump__actuator_offPB;
CB_Mem_Bool *_i_cmd_on_off_pump__actuator_generalFault;
CB_Mem_Bool *_i_cmd_on_off_pump__actuator_cmd;

/**************************** Variables *****************************/

#define autoMode (_i_cmd_on_off_pump__actuator_autoMode->CB_current_value)
#define manualMode (_i_cmd_on_off_pump__actuator_manualMode->CB_current_value)
#define autoCmd (_i_cmd_on_off_pump__actuator_autoCmd->CB_current_value)
#define onPB (_i_cmd_on_off_pump__actuator_onPB->CB_current_value)
#define offPB (_i_cmd_on_off_pump__actuator_offPB->CB_current_value)
#define generalFault (_i_cmd_on_off_pump__actuator_generalFault->CB_current_value)
#define cmd (_i_cmd_on_off_pump__actuator_cmd->CB_current_value)


/************************ Components offsets ************************/


/********************* Initialization function **********************/

static int _cmd_equipment_library__actuator_init(void)
{


	return 0;
}


/************************ Behavior function *************************/

static int cmd_equipment_library__actuator(void)
{
	if (exec_term_node(self_num)) {

		/*********************** Internals variables ************************/


		/********************* Pre-conditions execution *********************/

		/*no Pre-conditions*/

		/************************ Behavior execution ************************/

		{
			unsigned char _2;
			_2 = manualMode;
			cmd = ((autoMode && autoCmd) || (((_2 && onPB) || (_2 && cmd)) && !offPB)) && !generalFault;
		}

		CB_post_bool(_i_cmd_on_off_pump__actuator_cmd);

		/******************** Post-conditions execution *********************/

		/*no Post-conditions*/
	}

	/*************************** self update ****************************/


	return 0;
}

#undef autoMode
#undef manualMode
#undef autoCmd
#undef onPB
#undef offPB
#undef generalFault
#undef cmd

/********************************************************************
 *                  Inner 'faults' implementation                   *
 ********************************************************************/

#include "timers_counters/functional/cb_ton/cb_ton.h"


/**************************** Variables *****************************/

static CB_Index faults__num = 0;
CB_Mem_Bool *_i_cmd_on_off_pump__faults_cmd;
CB_Mem_Bool *_i_cmd_on_off_pump__faults_thermalFB;
CB_Mem_Bool *_i_cmd_on_off_pump__faults_onFB;
CB_Mem_Bool *_i_cmd_on_off_pump__faults_acknowledgePB;
CB_Mem_Bool *_i_cmd_on_off_pump__faults_generalFault;
CB_Mem_Bool *_i_cmd_on_off_pump__faults_thermalFault;
CB_Mem_Bool *_i_cmd_on_off_pump__faults_onFBFault;
CB_Mem_Bool *_i_cmd_on_off_pump__faults_TON_FB_IN;
CB_Mem_Int *_i_cmd_on_off_pump__faults_TON_FB_PT;
CB_Mem_Bool *_i_cmd_on_off_pump__faults_TON_FB_Q0;
CB_Mem_Int *_i_cmd_on_off_pump__faults_TON_FB_CV;

/**************************** Variables *****************************/

#define cmd (_i_cmd_on_off_pump__faults_cmd->CB_current_value)
#define thermalFB (_i_cmd_on_off_pump__faults_thermalFB->CB_current_value)
#define onFB (_i_cmd_on_off_pump__faults_onFB->CB_current_value)
#define acknowledgePB (_i_cmd_on_off_pump__faults_acknowledgePB->CB_current_value)
#define generalFault (_i_cmd_on_off_pump__faults_generalFault->CB_current_value)
#define thermalFault (_i_cmd_on_off_pump__faults_thermalFault->CB_current_value)
#define onFBFault (_i_cmd_on_off_pump__faults_onFBFault->CB_current_value)
#define TON_FB_IN (_i_cmd_on_off_pump__faults_TON_FB_IN->CB_current_value)
#define TON_FB_PT(i) (_i_cmd_on_off_pump__faults_TON_FB_PT[i+1].CB_current_value)
#define TON_FB_Q0 (_i_cmd_on_off_pump__faults_TON_FB_Q0->CB_current_value)
#define TON_FB_CV(i) (_i_cmd_on_off_pump__faults_TON_FB_CV[i+1].CB_current_value)


/************************ Components offsets ************************/

static CB_Index cmd_equipment_library__faults_dnum_TON_FB;
static CB_Index cmd_equipment_library__faults_dnum__end;

static CB_Offset cmd_equipment_library__faults_offset_TON_FB;
static CB_Offset cmd_equipment_library__faults_offset__end = {0, 0, 0, 0};


/********************* Initialization function **********************/

static int _cmd_equipment_library__faults_init(void)
{
	CB_Index __my_num = self_num;
	CB_Object __start = self;
	self.Bool+=4;
	self.Int+=8;

	/*initialize child TON_FB (timers_counters.cb_ton):*/
	self_num++;
	cmd_equipment_library__faults_dnum_TON_FB = self_num - __my_num;
	cmd_equipment_library__faults_offset_TON_FB.Bool = self.Bool - __start.Bool;
	cmd_equipment_library__faults_offset_TON_FB.Int = self.Int - __start.Int;
	cmd_equipment_library__faults_offset_TON_FB.Float = self.Float - __start.Float;
	cmd_equipment_library__faults_offset_TON_FB.Char = self.Char - __start.Char;
	cb_ton_IN = __start.Bool+2; /*TON_FB_IN*/
	cb_ton_PT = __start.Int+0; /*TON_FB_PT*/
	cb_ton_Q0 = __start.Bool+3; /*TON_FB_Q0*/
	cb_ton_CV = __start.Int+4; /*TON_FB_CV*/
	_timers_counters__cb_ton_init();

	cmd_equipment_library__faults_dnum__end = self_num - __my_num;
	cmd_equipment_library__faults_offset__end.Bool = self.Bool - __start.Bool;
	cmd_equipment_library__faults_offset__end.Int = self.Int - __start.Int;
	cmd_equipment_library__faults_offset__end.Float = self.Float - __start.Float;
	cmd_equipment_library__faults_offset__end.Char = self.Char - __start.Char;

	return 0;
}


/************************ Behavior function *************************/

static int cmd_equipment_library__faults(void)
{
	CB_Object __start = self;
	CB_Index __my_num = self_num;
	int __ret;
	if (exec_term_node(self_num)) {

		/*********************** Internals variables ************************/

		_i_cmd_on_off_pump__faults_thermalFault = self.Bool+0;
		_i_cmd_on_off_pump__faults_onFBFault = self.Bool+1;
		_i_cmd_on_off_pump__faults_TON_FB_IN = self.Bool+2;
		_i_cmd_on_off_pump__faults_TON_FB_PT = self.Int+0;
		_i_cmd_on_off_pump__faults_TON_FB_Q0 = self.Bool+3;
		_i_cmd_on_off_pump__faults_TON_FB_CV = self.Int+4;

		/********************* Pre-conditions execution *********************/

		/*no Pre-conditions*/

		/************************ Behavior execution ************************/

		{
			static CB_Mem_Int __literal_0[4] = {
				cb_int_header(2),
				cb_int(0),
				cb_int(20000)
			};
			unsigned char _1;
			unsigned char _9_Q0;
			CB_Mem_Int _9_CV[4] =  { cb_int_header(2) };
			_1 = acknowledgePB;
			if (_1) {
				thermalFault = 0;
			}
			if (_1) {
				onFBFault = 0;
			}
			if (_1) {
				generalFault = 0;
			}
			/*call user FB TON_FB():*/
			TON_FB_IN = cmd;
			copy_int_array(_i_cmd_on_off_pump__faults_TON_FB_PT, __literal_0, 2);
			self.Bool = __start.Bool + cmd_equipment_library__faults_offset_TON_FB.Bool;
			self.Int = __start.Int + cmd_equipment_library__faults_offset_TON_FB.Int;
			self.Float = __start.Float + cmd_equipment_library__faults_offset_TON_FB.Float;
			self.Char = __start.Char + cmd_equipment_library__faults_offset_TON_FB.Char;
			self_num = __my_num + cmd_equipment_library__faults_dnum_TON_FB;
			if (cb_ton__num != self_num) {
				cb_ton__num = self_num;
				cb_ton_IN = _i_cmd_on_off_pump__faults_TON_FB_IN;
				cb_ton_PT = _i_cmd_on_off_pump__faults_TON_FB_PT;
				cb_ton_Q0 = _i_cmd_on_off_pump__faults_TON_FB_Q0;
				cb_ton_CV = _i_cmd_on_off_pump__faults_TON_FB_CV;
			}
			__ret = timers_counters__cb_ton();
			if (__ret != 0) {
				return __ret; /*user FB failure*/
			}
			self_num = __my_num;
			_9_Q0 = TON_FB_Q0;
			copy_int_array(_9_CV, _i_cmd_on_off_pump__faults_TON_FB_CV, 2);
			/*end TON_FB()*/
			if (_9_Q0 && !onFB) {
				onFBFault = 1;
			}
			if (!thermalFB) {
				thermalFault = 1;
			}
			if (onFBFault || thermalFault) {
				generalFault = 1;
			}
		}

		if(nb_alloc > 0) {
			free_all_alloc();
		}

		CB_post_bool(_i_cmd_on_off_pump__faults_generalFault);

		/******************** Post-conditions execution *********************/

		/*no Post-conditions*/
	}

	/*************************** self update ****************************/

	self_num = __my_num + cmd_equipment_library__faults_dnum__end;
	self.Bool = __start.Bool + cmd_equipment_library__faults_offset__end.Bool;
	self.Int = __start.Int + cmd_equipment_library__faults_offset__end.Int;
	self.Float = __start.Float + cmd_equipment_library__faults_offset__end.Float;
	self.Char = __start.Char + cmd_equipment_library__faults_offset__end.Char;

	return 0;
}

#undef cmd
#undef thermalFB
#undef onFB
#undef acknowledgePB
#undef generalFault
#undef thermalFault
#undef onFBFault
#undef TON_FB_IN
#undef TON_FB_PT
#undef TON_FB_Q0
#undef TON_FB_CV

/********************************************************************
 *  Public 'cmd_equipment_library.cmd_on_off_pump' implementation   *
 ********************************************************************/

#include "cmd_on_off_pump.h"


/**************************** Variables *****************************/

CB_Index cmd_on_off_pump__num = 0;
CB_Mem_Bool *cmd_on_off_pump_autoMode;
CB_Mem_Bool *cmd_on_off_pump_manualMode;
CB_Mem_Bool *cmd_on_off_pump_autoCmd;
CB_Mem_Bool *cmd_on_off_pump_thermalFB;
CB_Mem_Bool *cmd_on_off_pump_onFB;
CB_Mem_Bool *cmd_on_off_pump_onPB;
CB_Mem_Bool *cmd_on_off_pump_offPB;
CB_Mem_Bool *cmd_on_off_pump_acknowledgePB;
CB_Mem_Bool *cmd_on_off_pump_cmd;
CB_Mem_Bool *cmd_on_off_pump_generalFault;

/**************************** Variables *****************************/



/************************ Components offsets ************************/

static CB_Offset cmd_equipment_library__cmd_on_off_pump_offset_actions;
static CB_Offset cmd_equipment_library__cmd_on_off_pump_offset_faults1;
static CB_Offset cmd_equipment_library__cmd_on_off_pump_offset__end = {0, 0, 0, 0};


/********************* Initialization function **********************/

int _cmd_equipment_library__cmd_on_off_pump_init(void)
{
	CB_Object __start = self;

	/*initialize child actions (cmd_equipment_library.actuator):*/
	self_num++;
	cmd_equipment_library__cmd_on_off_pump_offset_actions.Bool = self.Bool - __start.Bool;
	cmd_equipment_library__cmd_on_off_pump_offset_actions.Int = self.Int - __start.Int;
	cmd_equipment_library__cmd_on_off_pump_offset_actions.Float = self.Float - __start.Float;
	cmd_equipment_library__cmd_on_off_pump_offset_actions.Char = self.Char - __start.Char;
	_i_cmd_on_off_pump__actuator_autoMode = cmd_on_off_pump_autoMode;
	_i_cmd_on_off_pump__actuator_manualMode = cmd_on_off_pump_manualMode;
	_i_cmd_on_off_pump__actuator_autoCmd = cmd_on_off_pump_autoCmd;
	_i_cmd_on_off_pump__actuator_onPB = cmd_on_off_pump_onPB;
	_i_cmd_on_off_pump__actuator_offPB = cmd_on_off_pump_offPB;
	_i_cmd_on_off_pump__actuator_generalFault = cmd_on_off_pump_generalFault;
	_i_cmd_on_off_pump__actuator_cmd = cmd_on_off_pump_cmd;
	_cmd_equipment_library__actuator_init();

	/*initialize child faults1 (cmd_equipment_library.faults):*/
	self_num++;
	cmd_equipment_library__cmd_on_off_pump_offset_faults1.Bool = self.Bool - __start.Bool;
	cmd_equipment_library__cmd_on_off_pump_offset_faults1.Int = self.Int - __start.Int;
	cmd_equipment_library__cmd_on_off_pump_offset_faults1.Float = self.Float - __start.Float;
	cmd_equipment_library__cmd_on_off_pump_offset_faults1.Char = self.Char - __start.Char;
	_i_cmd_on_off_pump__faults_cmd = cmd_on_off_pump_cmd;
	_i_cmd_on_off_pump__faults_thermalFB = cmd_on_off_pump_thermalFB;
	_i_cmd_on_off_pump__faults_onFB = cmd_on_off_pump_onFB;
	_i_cmd_on_off_pump__faults_acknowledgePB = cmd_on_off_pump_acknowledgePB;
	_i_cmd_on_off_pump__faults_generalFault = cmd_on_off_pump_generalFault;
	_cmd_equipment_library__faults_init();

	cmd_equipment_library__cmd_on_off_pump_offset__end.Bool = self.Bool - __start.Bool;
	cmd_equipment_library__cmd_on_off_pump_offset__end.Int = self.Int - __start.Int;
	cmd_equipment_library__cmd_on_off_pump_offset__end.Float = self.Float - __start.Float;
	cmd_equipment_library__cmd_on_off_pump_offset__end.Char = self.Char - __start.Char;

	return 0;
}


/************************ Behavior function *************************/

int cmd_equipment_library__cmd_on_off_pump(void)
{
	CB_Object __start = self;
	int __ret;
	if (exec_mac_node(self_num)) {

		/*********************** Internals variables ************************/


		/********************* Pre-conditions execution *********************/

		/*no Pre-conditions*/

		/************************ Behavior execution ************************/

		{
			self.Bool = __start.Bool + cmd_equipment_library__cmd_on_off_pump_offset_actions.Bool;
			self.Int = __start.Int + cmd_equipment_library__cmd_on_off_pump_offset_actions.Int;
			self.Float = __start.Float + cmd_equipment_library__cmd_on_off_pump_offset_actions.Float;
			self.Char = __start.Char + cmd_equipment_library__cmd_on_off_pump_offset_actions.Char;

			/************************ actions execution *************************/

			self_num++;
			if (actuator__num != self_num) {
				actuator__num = self_num;
				_i_cmd_on_off_pump__actuator_autoMode = cmd_on_off_pump_autoMode;
				_i_cmd_on_off_pump__actuator_manualMode = cmd_on_off_pump_manualMode;
				_i_cmd_on_off_pump__actuator_autoCmd = cmd_on_off_pump_autoCmd;
				_i_cmd_on_off_pump__actuator_onPB = cmd_on_off_pump_onPB;
				_i_cmd_on_off_pump__actuator_offPB = cmd_on_off_pump_offPB;
				_i_cmd_on_off_pump__actuator_generalFault = cmd_on_off_pump_generalFault;
				_i_cmd_on_off_pump__actuator_cmd = cmd_on_off_pump_cmd;
			}
			__ret = cmd_equipment_library__actuator();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

			/************************ faults1 execution *************************/

			self_num++;
			if (faults__num != self_num) {
				faults__num = self_num;
				_i_cmd_on_off_pump__faults_cmd = cmd_on_off_pump_cmd;
				_i_cmd_on_off_pump__faults_thermalFB = cmd_on_off_pump_thermalFB;
				_i_cmd_on_off_pump__faults_onFB = cmd_on_off_pump_onFB;
				_i_cmd_on_off_pump__faults_acknowledgePB = cmd_on_off_pump_acknowledgePB;
				_i_cmd_on_off_pump__faults_generalFault = cmd_on_off_pump_generalFault;
			}
			__ret = cmd_equipment_library__faults();
			if (__ret != 0) {
				return __ret; /*child execution failure*/
			}

		}


		/******************** Post-conditions execution *********************/

		/*no Post-conditions*/
	}

	/*************************** self update ****************************/

	self.Bool = __start.Bool + cmd_equipment_library__cmd_on_off_pump_offset__end.Bool;
	self.Int = __start.Int + cmd_equipment_library__cmd_on_off_pump_offset__end.Int;
	self.Float = __start.Float + cmd_equipment_library__cmd_on_off_pump_offset__end.Float;
	self.Char = __start.Char + cmd_equipment_library__cmd_on_off_pump_offset__end.Char;

	return 0;
}

