/*2023-10-03T11:12:52-01:00*/

/********************************************************************
 * binary_encoder.c
 * 
 * generated by: plcgen 3.1.391
 ********************************************************************/

#include "cb_comp.h"
#include "iec_1131.h"

#include "binary_encoder.h"



/**************************** Variables *****************************/

CB_Index binary_encoder__num = 0;
CB_Mem_Int *binary_encoder_binaryInput;
CB_Mem_Bool *binary_encoder_encoderFreezing;
CB_Mem_Bool *binary_encoder_bit00;
CB_Mem_Bool *binary_encoder_bit01;
CB_Mem_Bool *binary_encoder_bit02;
CB_Mem_Bool *binary_encoder_bit03;
CB_Mem_Bool *binary_encoder_bit04;
CB_Mem_Bool *binary_encoder_bit05;
CB_Mem_Bool *binary_encoder_bit06;
CB_Mem_Bool *binary_encoder_bit07;
CB_Mem_Bool *binary_encoder_bit08;
CB_Mem_Bool *binary_encoder_bit09;
CB_Mem_Bool *binary_encoder_bit10;
CB_Mem_Bool *binary_encoder_bit11;
CB_Mem_Bool *binary_encoder_bit12;
CB_Mem_Bool *binary_encoder_bit13;
CB_Mem_Bool *binary_encoder_bit14;
CB_Mem_Bool *binary_encoder_bit15;
CB_Mem_Bool *binary_encoder_bit16;
CB_Mem_Int *binary_encoder_wordOutput;
CB_Mem_Int *binary_encoder_inputValue;
CB_Mem_Bool *binary_encoder_parity;
CB_Mem_Bool *binary_encoder_evenParity;
CB_Mem_Bool *binary_encoder_oddParity;
CB_Mem_Bool *binary_encoder_d_presetting;
CB_Mem_Int *binary_encoder_v_d_presetting;

/**************************** Variables *****************************/

#define binaryInput (binary_encoder_binaryInput->CB_current_value)
#define encoderFreezing (binary_encoder_encoderFreezing->CB_current_value)
#define bit00 (binary_encoder_bit00->CB_current_value)
#define bit01 (binary_encoder_bit01->CB_current_value)
#define bit02 (binary_encoder_bit02->CB_current_value)
#define bit03 (binary_encoder_bit03->CB_current_value)
#define bit04 (binary_encoder_bit04->CB_current_value)
#define bit05 (binary_encoder_bit05->CB_current_value)
#define bit06 (binary_encoder_bit06->CB_current_value)
#define bit07 (binary_encoder_bit07->CB_current_value)
#define bit08 (binary_encoder_bit08->CB_current_value)
#define bit09 (binary_encoder_bit09->CB_current_value)
#define bit10 (binary_encoder_bit10->CB_current_value)
#define bit11 (binary_encoder_bit11->CB_current_value)
#define bit12 (binary_encoder_bit12->CB_current_value)
#define bit13 (binary_encoder_bit13->CB_current_value)
#define bit14 (binary_encoder_bit14->CB_current_value)
#define bit15 (binary_encoder_bit15->CB_current_value)
#define bit16 (binary_encoder_bit16->CB_current_value)
#define wordOutput (binary_encoder_wordOutput->CB_current_value)
#define inputValue (binary_encoder_inputValue->CB_current_value)
#define parity (binary_encoder_parity->CB_current_value)
#define evenParity (binary_encoder_evenParity->CB_current_value)
#define oddParity (binary_encoder_oddParity->CB_current_value)
#define d_presetting (binary_encoder_d_presetting->CB_current_value)
#define v_d_presetting (binary_encoder_v_d_presetting->CB_current_value)


/************************ Components offsets ************************/


/********************* Initialization function **********************/

int _equipment_library__binary_encoder_init(void)
{
	(self.Bool+2)->CB_current_value = 1; /*oddParity*/
	self.Bool+=4;
	self.Int+=2;


	return 0;
}


/************************ Behavior function *************************/

int equipment_library__binary_encoder(void)
{
	if (exec_term_node(self_num)) {

		/*********************** Internals variables ************************/

		binary_encoder_inputValue = self.Int+0;
		binary_encoder_parity = self.Bool+0;
		binary_encoder_evenParity = self.Bool+1;
		binary_encoder_oddParity = self.Bool+2;
		binary_encoder_d_presetting = self.Bool+3;
		binary_encoder_v_d_presetting = self.Int+1;

		/********************* Pre-conditions execution *********************/

		/*no Pre-conditions*/

		/************************ Behavior execution ************************/

		{
			/* ----------------------------------------------------------------	*/
			/* Type : Model of Operative Behaviour					*/
			/* Category :  Sensors							*/
			/* Author : Dassault Systemes						*/
			/* Update date : June 2018							*/
			/* ----------------------------------------------------------------	*/
			/* This module simulates the behaviour 					*/
			/* of a binary encoder.							*/
			/* The whole value is encoded on 15 bits					*/
			/*	the 16th bit is the parity bit. 					*/
			/* ----------------------------------------------------------------	*/

			/* ----------------------------------------------------------------	*/
			/* Treatment of presetting fault						*/
			/* ----------------------------------------------------------------	*/
			if (d_presetting) inputValue = v_d_presetting;
			else inputValue = binaryInput;


			/* ----------------------------------------------------------------	*/
			/* Encoder management							*/
			/* ----------------------------------------------------------------	*/
			if (!encoderFreezing) {
				bit00 = 0;
				bit01 = 0;
				bit02 = 0;
				bit03 = 0;
				bit04 = 0;
				bit05 = 0;
				bit06 = 0;
				bit07 = 0;
				bit08 = 0;
				bit09 = 0;
				bit10 = 0;
				bit11 = 0;
				bit12 = 0;
				bit13 = 0;
				bit14 = 0;
				bit15 = 0;

				if ((inputValue & 1)>0) bit00 = 1;
				if ((inputValue & 2)>0) bit01 = 1;
				if ((inputValue & 4)>0) bit02 = 1;
				if ((inputValue & 8)>0) bit03 = 1;
				if ((inputValue & 16)>0) bit04 = 1;
				if ((inputValue & 32)>0) bit05 = 1;
				if ((inputValue & 64)>0) bit06 = 1;
				if ((inputValue & 128)>0) bit07 = 1;
				if ((inputValue & 256)>0) bit08 = 1;
				if ((inputValue & 512)>0) bit09 = 1;
				if ((inputValue & 1024)>0) bit10 = 1;
				if ((inputValue & 2048)>0) bit11 = 1;
				if ((inputValue & 4096)>0) bit12 = 1;
				if ((inputValue & 8192)>0) bit13 = 1;
				if ((inputValue & 16384)>0) bit14 = 1;
				if ((inputValue & 32768)>0) bit15 = 1;

				/* -----------------------------------------------------------------------------------------------------------	*/
				/* 	Calcul de la parity : Si parity = 0 => parity paire		*/
				/* -----------------------------------------------------------------------------------------------------------	*/
				parity =((((((((((((((bit00 ^ bit01) ^ bit02) ^ bit03) ^ bit04) ^ bit05) ^ bit06) ^ bit07) ^ bit08)
						 ^ bit09) ^ bit10) ^ bit11) ^ bit12) ^ bit13) ^ bit14);

				if (evenParity && !oddParity) bit15 = parity;
				else if(!evenParity && oddParity) bit15 = !parity;

				/* -----------------------------------------------------------------------------------------------------------	*/
				/*	Traitement sortie sur mot						*/
				/* -----------------------------------------------------------------------------------------------------------	*/
				wordOutput = 0;
				if (bit00)  wordOutput = wordOutput + 1;
				if (bit01)  wordOutput = wordOutput + 2;
				if (bit02)  wordOutput = wordOutput + 4;
				if (bit03)  wordOutput = wordOutput + 8;
				if (bit04)  wordOutput = wordOutput + 16;
				if (bit05)  wordOutput = wordOutput + 32;
				if (bit06)  wordOutput = wordOutput + 64;
				if (bit07)  wordOutput = wordOutput + 128;
				if (bit08)  wordOutput = wordOutput + 256;
				if (bit09)  wordOutput = wordOutput + 512;
				if (bit10)  wordOutput = wordOutput + 1024;
				if (bit11)  wordOutput = wordOutput + 2048;
				if (bit12)  wordOutput = wordOutput + 4096;
				if (bit13)  wordOutput = wordOutput + 8192;
				if (bit14)  wordOutput = wordOutput + 16384;
				if (bit15)  wordOutput = wordOutput + 32768;
			}
		}

		CB_post_bool(binary_encoder_bit00);
		CB_post_bool(binary_encoder_bit01);
		CB_post_bool(binary_encoder_bit02);
		CB_post_bool(binary_encoder_bit03);
		CB_post_bool(binary_encoder_bit04);
		CB_post_bool(binary_encoder_bit05);
		CB_post_bool(binary_encoder_bit06);
		CB_post_bool(binary_encoder_bit07);
		CB_post_bool(binary_encoder_bit08);
		CB_post_bool(binary_encoder_bit09);
		CB_post_bool(binary_encoder_bit10);
		CB_post_bool(binary_encoder_bit11);
		CB_post_bool(binary_encoder_bit12);
		CB_post_bool(binary_encoder_bit13);
		CB_post_bool(binary_encoder_bit14);
		CB_post_bool(binary_encoder_bit15);
		CB_post_bool(binary_encoder_bit16);
		CB_post_int(binary_encoder_wordOutput);

		/******************** Post-conditions execution *********************/

		/*no Post-conditions*/
	}

	/*************************** self update ****************************/

	self.Bool += 4;
	self.Int += 2;

	return 0;
}

